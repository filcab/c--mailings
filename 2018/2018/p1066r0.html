<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>p1066R0: How to catch an exception_ptr without even try-ing</title>
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="p1066r0.html#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: medium;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
		border-bottom-width: 3px !important;
		margin-bottom: 0px !important;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li li { font-size:   85%;    }

	.toc > li             { margin: 1.5rem 0;    }
	.toc > li li          { margin: 0.3rem 0;    }
	.toc > li li li       { margin-left: 2rem;   }

	/* Section numbers in a column of their own */
	.toc .secno {
		float: left;
		width: 4rem;
		white-space: nowrap;
	}
	.toc > li li li li .secno {
		font-size: 85%;
	}
	.toc > li li li li li .secno {
		font-size: 100%;
	}

	:not(li) > .toc              { margin-left:  5rem; }
	.toc .secno                  { margin-left: -5rem; }
	.toc > li li li .secno       { margin-left: -7rem; }
	.toc > li li li li .secno    { margin-left: -9rem; }
	.toc > li li li li li .secno { margin-left: -11rem; }

	/* Tighten up indentation in narrow ToCs */
	@media (max-width: 30em) {
		:not(li) > .toc              { margin-left:  4rem; }
		.toc .secno                  { margin-left: -4rem; }
		.toc > li li li              { margin-left:  1rem; }
		.toc > li li li .secno       { margin-left: -5rem; }
		.toc > li li li li .secno    { margin-left: -6rem; }
		.toc > li li li li li .secno { margin-left: -7rem; }
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
		body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
		body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
		body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
		body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
		body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	body.toc-sidebar #toc :not(li) > .toc              { margin-left:  4rem; }
	body.toc-sidebar #toc .toc .secno                  { margin-left: -4rem; }
	body.toc-sidebar #toc .toc > li li li              { margin-left:  1rem; }
	body.toc-sidebar #toc .toc > li li li .secno       { margin-left: -5rem; }
	body.toc-sidebar #toc .toc > li li li li .secno    { margin-left: -6rem; }
	body.toc-sidebar #toc .toc > li li li li li .secno { margin-left: -7rem; }

	.toc li {
		clear: both;
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-left: calc(13px + 26.5rem - 50vw);
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-left: calc(40em - 50vw) !important;
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-left: 0 !important;
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
<style type="text/css">
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      vertical-align: top;
    }
    th, td {
      border-left: none;
      border-right: none;
      padding: 0px 10px;
    }
    th {
      text-align: center;
    }
  </style>
  <meta content="Bikeshed version 374411ba509d23f8a91b3530bae1f342eb291098" name="generator">
  <link href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/wg21.link/P1066" rel="canonical">
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: gray;
    color: white;
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: black;
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: #005a9c;
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */

.highlight:not(.idl) { background: hsl(24, 20%, 95%); }
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
.highlight .c { color: #708090 } /* Comment */
.highlight .k { color: #990055 } /* Keyword */
.highlight .l { color: #000000 } /* Literal */
.highlight .n { color: #0077aa } /* Name */
.highlight .o { color: #999999 } /* Operator */
.highlight .p { color: #999999 } /* Punctuation */
.highlight .cm { color: #708090 } /* Comment.Multiline */
.highlight .cp { color: #708090 } /* Comment.Preproc */
.highlight .c1 { color: #708090 } /* Comment.Single */
.highlight .cs { color: #708090 } /* Comment.Special */
.highlight .kc { color: #990055 } /* Keyword.Constant */
.highlight .kd { color: #990055 } /* Keyword.Declaration */
.highlight .kn { color: #990055 } /* Keyword.Namespace */
.highlight .kp { color: #990055 } /* Keyword.Pseudo */
.highlight .kr { color: #990055 } /* Keyword.Reserved */
.highlight .kt { color: #990055 } /* Keyword.Type */
.highlight .ld { color: #000000 } /* Literal.Date */
.highlight .m { color: #000000 } /* Literal.Number */
.highlight .s { color: #a67f59 } /* Literal.String */
.highlight .na { color: #0077aa } /* Name.Attribute */
.highlight .nc { color: #0077aa } /* Name.Class */
.highlight .no { color: #0077aa } /* Name.Constant */
.highlight .nd { color: #0077aa } /* Name.Decorator */
.highlight .ni { color: #0077aa } /* Name.Entity */
.highlight .ne { color: #0077aa } /* Name.Exception */
.highlight .nf { color: #0077aa } /* Name.Function */
.highlight .nl { color: #0077aa } /* Name.Label */
.highlight .nn { color: #0077aa } /* Name.Namespace */
.highlight .py { color: #0077aa } /* Name.Property */
.highlight .nt { color: #669900 } /* Name.Tag */
.highlight .nv { color: #222222 } /* Name.Variable */
.highlight .ow { color: #999999 } /* Operator.Word */
.highlight .mb { color: #000000 } /* Literal.Number.Bin */
.highlight .mf { color: #000000 } /* Literal.Number.Float */
.highlight .mh { color: #000000 } /* Literal.Number.Hex */
.highlight .mi { color: #000000 } /* Literal.Number.Integer */
.highlight .mo { color: #000000 } /* Literal.Number.Oct */
.highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
.highlight .sc { color: #a67f59 } /* Literal.String.Char */
.highlight .sd { color: #a67f59 } /* Literal.String.Doc */
.highlight .s2 { color: #a67f59 } /* Literal.String.Double */
.highlight .se { color: #a67f59 } /* Literal.String.Escape */
.highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
.highlight .si { color: #a67f59 } /* Literal.String.Interpol */
.highlight .sx { color: #a67f59 } /* Literal.String.Other */
.highlight .sr { color: #a67f59 } /* Literal.String.Regex */
.highlight .s1 { color: #a67f59 } /* Literal.String.Single */
.highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
.highlight .vc { color: #0077aa } /* Name.Variable.Class */
.highlight .vg { color: #0077aa } /* Name.Variable.Global */
.highlight .vi { color: #0077aa } /* Name.Variable.Instance */
.highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">p1066R0<br>How to catch an exception_ptr without even try-ing</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Published Proposal, <time class="dt-updated" datetime="2018-05-07">7 May 2018</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/wg21.link/P1066">wg21.link/P1066</a>
     <dt>Author:
     <dd>
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:redbeard0531+isocpp@gmail.com">Mathias Stearn</a> (<span class="p-org org">MongoDB</span>)
     <dt>Audience:
     <dd>EWG, LEWG
     <dt>Project:
     <dd>ISO JTC1/SC22/WG21: Programming Language C++
     <dt>Latest Version:
     <dd><a href="https://api.csswg.org/bikeshed/?url=https://raw.githubusercontent.com/RedBeard0531/better_exception_ptr/master/better_exception_ptr.bs&amp;force=1">Click here</a>
     <dt>Source:
     <dd><a href="https://github.com/RedBeard0531/better_exception_ptr/blob/master/better_exception_ptr.bs">No real reason to click here</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>Adding facilities to inspect and handle std::exception_ptr without throwing and catching. This mechanism should work even in environments that use -fno-exceptions.</p>
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="p1066r0.html#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="p1066r0.html#proposal"><span class="secno">2</span> <span class="content">Proposal</span></a>
     <ol class="toc">
      <li>
       <a href="p1066r0.html#high-level-api"><span class="secno">2.1</span> <span class="content">High-level API</span></a>
       <ol class="toc">
        <li><a href="p1066r0.html#handle"><span class="secno">2.1.1</span> <span class="content"><span>handle()<span></span></span></span></a>
        <li><a href="p1066r0.html#handle_or_terminate"><span class="secno">2.1.2</span> <span class="content"><span>handle_or_terminate()<span></span></span></span></a>
        <li><a href="p1066r0.html#try_catch"><span class="secno">2.1.3</span> <span class="content"><span>try_catch()<span></span></span></span></a>
        <li><a href="p1066r0.html#terminate_with_active"><span class="secno">2.1.4</span> <span class="content"><span>terminate_with_active()<span></span></span></span></a>
       </ol>
      <li>
       <a href="p1066r0.html#low-level-api"><span class="secno">2.2</span> <span class="content">Low-level API</span></a>
       <ol class="toc">
        <li><a href="p1066r0.html#type"><span class="secno">2.2.1</span> <span class="content"><span>type()</span></span></a>
        <li><a href="p1066r0.html#get_raw_ptr"><span class="secno">2.2.2</span> <span class="content"><span>get_raw_ptr()</span></span></a>
       </ol>
     </ol>
    <li>
     <a href="p1066r0.html#use-cases"><span class="secno">3</span> <span class="content">Use Cases</span></a>
     <ol class="toc">
      <li><a href="p1066r0.html#lippincott-functions"><span class="secno">3.1</span> <span class="content">Lippincott Functions</span></a>
      <li><a href="p1066r0.html#terminate-handlers"><span class="secno">3.2</span> <span class="content">Terminate Handlers</span></a>
      <li><a href="p1066r0.html#stdexpected-and-similar-types"><span class="secno">3.3</span> <span class="content"><code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">expected</span></code> and Similar Types</span></a>
      <li><a href="p1066r0.html#error-handling-in-futures"><span class="secno">3.4</span> <span class="content">Error Handling in Futures</span></a>
     </ol>
    <li><a href="p1066r0.html#it-sounds-like-you-just-want-faster-exception-handling-why-isnt-this-just-a-qoi-issue"><span class="secno">4</span> <span class="content">It sounds like you just want faster exception handling. Why isn’t this just a QoI issue?</span></a>
    <li>
     <a href="p1066r0.html#related-future-work"><span class="secno">5</span> <span class="content">Related Future Work</span></a>
     <ol class="toc">
      <li><a href="p1066r0.html#support-dynamic-dynamic_cast-using-type_info"><span class="secno">5.1</span> <span class="content">Support dynamic <code class="highlight"><span class="k">dynamic_cast</span></code> using <code class="highlight"><span class="n">type_info</span></code></span></a>
      <li><a href="p1066r0.html#dynamic_any_cast"><span class="secno">5.2</span> <span class="content"><code class="highlight"><span class="n">dynamic_any_cast</span></code></span></a>
      <li><a href="p1066r0.html#less-copies-in-stdmake_exception_ptr-e-e"><span class="secno">5.3</span> <span class="content">Less copies in <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">make_exception_ptr</span><span class="p">(</span><span class="n">E</span> <span class="n">e</span><span class="p">)</span></code></span></a>
     </ol>
    <li>
     <a href="p1066r0.html#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="p1066r0.html#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
     </ol>
    <li>
     <a href="p1066r0.html#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="p1066r0.html#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="p1066r0.html#introduction"></a></h2>
   <p><code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">exception_ptr</span></code> is a weird beast. Unlike the other <code class="highlight"><span class="n">_ptr</span></code> types it is completely type erased,
similar to a hypothetical <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">any_ptr</span></code>. Presumably because of this, it is the only <code class="highlight"><span class="n">_ptr</span></code> type to
offer no <code class="highlight"><span class="n">get</span><span class="p">()</span></code> method, since it wouldn’t know what type to return. You might even say it should
take <a data-link-type="biblio" href="p1066r0.html#biblio-n4282">[N4282]</a>'s tile as <em>"The World’s Dumbest Smart Pointer"</em> since the only way to dereference it
is by throwing!</p>
   <p>This proposal suggests adding methods to <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">exception_ptr</span></code> to directly access the pointed-to
exception in a type-safe manner. On standard libraries that implement <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">make_exception_ptr</span></code> by
direct construction rather than using <code class="highlight"><span class="k">try</span></code>/<code class="highlight"><span class="k">throw</span></code>/<code class="highlight"><span class="k">catch</span></code>/<code class="highlight"><span class="n">current_exeption</span><span class="p">()</span></code> (currently MS-STL
and libstdc++, but not libc++), it should now be possible to both create and consume a <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">exception_ptr</span></code> with full fidelity even with exceptions disabled. This should ease
interoperability between codebases and libraries that choose to use exceptions and those that do
not.</p>
   <p>I have a proof of implementability without ABI breakage <a href="https://github.com/RedBeard0531/better_exception_ptr/blob/master/better_exception_ptr.h">here</a>. It
is an implementation of the proposed methods for both MSVC and libstdc++. On Linux, it is <strong>385</strong> times faster than using <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">rethrow_exception</span></code> and <code class="highlight"><span class="k">catch</span></code> as is needed today. On Windows, it is <em>only</em> 10 times faster due to needing to trap into the kernel to call <a href="https://msdn.microsoft.com/en-us/library/bb432242(v=vs.85).aspx"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="decodepointer">DecodePointer()</dfn></a>.
I haven’t tested on libc++ or with the special ARM EH ABI, but based on my reading of those
implementations, the same strategy should work fine. Pull requests welcome!</p>
   <h2 class="heading settled" data-level="2" id="proposal"><span class="secno">2. </span><span class="content">Proposal</span><a class="self-link" href="p1066r0.html#proposal"></a></h2>
   <p>This is an informal descriptions of the methods I propose adding to <code class="highlight"><span class="n">exception_ptr</span></code>. I don’t have
fully fleshed out proposed wording yet.</p>
   <p>All pointers returned by this API are valid until this <code class="highlight"><span class="n">exception_ptr</span></code> is destroyed or assigned
over. Copying or moving the <code class="highlight"><span class="n">exception_ptr</span></code> will not extend the validity of the pointers.</p>
   <p>Calling any of these methods on a null <code class="highlight"><span class="n">exception_ptr</span></code> is UB.</p>
   <h3 class="heading settled" data-level="2.1" id="high-level-api"><span class="secno">2.1. </span><span class="content">High-level API</span><a class="self-link" href="p1066r0.html#high-level-api"></a></h3>
   <h4 class="heading settled" data-level="2.1.1" id="handle"><span class="secno">2.1.1. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="handle①">handle()<dfn></dfn></dfn></span><a class="self-link" href="p1066r0.html#handle"></a></h4>
<pre class="language-cpp highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Handlers</span><span class="o">></span>
<span class="cm">/*see below*/</span> <span class="n">handle</span><span class="p">(</span><span class="n">Handlers</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">handlers</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="kt">bool</span> <span class="nf">handle</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> false<span class="p">;</span> <span class="p">}</span>
</pre>
   <p>Handles the contained exception as if there were a sequence of <code class="highlight"><span class="k">catch</span></code> blocks that catch the
argument type of each handler. The argument type is determined in a similar way to the <code class="highlight"><span class="n">function</span><span class="p">(</span><span class="n">Handler</span><span class="p">)</span><span class="o">::</span><span class="n">argument</span></code> <a href="http://en.cppreference.com/w/cpp/utility/functional/function/deduction_guides">template deduction
guide</a> to detect the
first and only argument type of a Callable object. However, it must also detect an <code class="highlight"><span class="n">R</span><span class="p">(...)</span></code> callable
as the natural analog of the <code class="highlight"><span class="k">catch</span><span class="p">(...)</span></code> catch-all. If present, the catch-all must be the last
handler.</p>
   <p>The return type of <code class="highlight"><span class="n">handle</span><span class="p">()</span></code> is the natural meaning of combining the return types from all handers
and making it optional to express nothing being caught. More formally:</p>
<pre class="language-cpp highlight"><span class="k">using</span> <span class="n">CommonReturnType</span> <span class="o">=</span> <span class="n">common_type_t</span><span class="o">&lt;</span><span class="n">result_of_t</span><span class="o">&lt;</span><span class="n">Handlers</span><span class="o">></span><span class="p">...</span><span class="o">></span><span class="p">;</span>
<span class="k">using</span> <span class="n">ReturnType</span> <span class="o">=</span> <span class="n">conditional_t</span><span class="o">&lt;</span><span class="n">is_void_v</span><span class="o">&lt;</span><span class="n">CommonReturnType</span><span class="o">></span><span class="p">,</span>
                                 <span class="kt">bool</span><span class="p">,</span>
                                 <span class="n">optional</span><span class="o">&lt;</span><span class="n">CommonReturnType</span><span class="o">>></span><span class="p">;</span>
</pre>
   <p>If none of the handlers match the contained exception type, the call to <code class="highlight"><span class="n">handle</span><span class="p">()</span></code> returns either <code class="highlight">false</code> or an empty <code class="highlight"><span class="n">optional</span></code>. If any handler matches, it returns either <code class="highlight">true</code> or an <code class="highlight"><span class="n">optional</span></code> constructed from the handler’s return value.</p>
   <p>This API is inspired by <a href="https://github.com/facebook/folly/blob/0a5110143325a4db5a0a7de98531a46064731fb7/folly/ExceptionWrapper.h#L569-L606">folly::exception_wrapper</a>.
It can be implemented in the standard today, albeit without the performance benefits. Additionally,
I think the valid lifetimes of the references would be shorter than is proposed here.</p>
   <h4 class="heading settled" data-level="2.1.2" id="handle_or_terminate"><span class="secno">2.1.2. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="handle_or_terminate①">handle_or_terminate()<dfn></dfn><a class="self-link" href="p1066r0.html#handle_or_terminate①"></a></dfn></span><a class="self-link" href="p1066r0.html#handle_or_terminate"></a></h4>
<pre class="language-cpp highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Handlers</span><span class="o">></span>
<span class="n">common_type_t</span><span class="o">&lt;</span><span class="n">result_of_t</span><span class="o">&lt;</span><span class="n">Handlers</span><span class="o">></span><span class="p">...</span><span class="o">></span>
<span class="n">handle_or_terminate</span><span class="p">(</span><span class="n">Handlers</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">handlers</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</pre>
   <p>Similar to <a data-link-type="dfn" href="p1066r0.html#handle①" id="ref-for-handle①">handle()</a>, but calls <a data-link-type="dfn" href="p1066r0.html#terminate_with_active①" id="ref-for-terminate_with_active①">terminate_with_active()</a> if no handler matches the current
exception. Unwraps the return type since if it returns, a handler must have matched.</p>
   <h4 class="heading settled" data-level="2.1.3" id="try_catch"><span class="secno">2.1.3. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="try_catch①">try_catch()<dfn></dfn></dfn></span><a class="self-link" href="p1066r0.html#try_catch"></a></h4>
<pre class="language-cpp highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">></span> <span class="n">requires</span> <span class="n">is_reference_v</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span>
<span class="n">add_pointer_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span> <span class="n">try_catch</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">></span> <span class="n">requires</span> <span class="n">is_pointer_v</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span>
<span class="n">optional</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span> <span class="n">try_catch</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</pre>
   <p>If the contained exception is catchable by a <code class="highlight"><span class="k">catch</span><span class="p">(</span><span class="n">T</span><span class="p">)</span></code> block, returns either a pointer to the
exception if <code class="highlight"><span class="n">T</span></code> is a reference or an <code class="highlight"><span class="n">optional</span></code> containing the caught pointer if <code class="highlight"><span class="n">T</span></code> is a pointer.
If the <code class="highlight"><span class="k">catch</span><span class="p">(</span><span class="n">T</span><span class="p">)</span></code> block would not catch the exception, returns <code class="highlight"><span class="n">nullopt</span></code>/<code class="highlight"><span class="k">nullptr</span></code>.</p>
   <p>The pointer case is a bit odd and throwing/catching pointer is fairly rare so it could use some
explanation for why it is both different and the same as the reference case. They have different
return types because returning <code class="highlight"><span class="n">T</span><span class="o">*</span></code> is impossible since the exception holds a <code class="highlight"><span class="n">U</span><span class="o">*</span></code> and <code class="highlight"><span class="n">T</span></code> may be <code class="highlight"><span class="n">X</span><span class="o">*</span></code>, and there is no <code class="highlight"><span class="n">X</span><span class="o">*</span></code> object to return a pointer to. Returning <code class="highlight"><span class="n">T</span></code>/<code class="highlight"><span class="n">X</span><span class="o">*</span></code> in this case would also
be incorrect because there would be no way to distinguish a thrown null pointer from a type
mismatch. Luckily, <code class="highlight"><span class="n">optional</span><span class="o">&lt;</span><span class="n">T</span><span class="o">></span></code> has the same access API as <code class="highlight"><span class="n">T</span><span class="o">*</span></code> so even though the return types of
these functions are different, consumers can treat them the same:</p>
<pre class="language-cpp highlight"><span class="k">if</span> <span class="p">(</span><span class="k">auto</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">ex_ptr</span><span class="p">.</span><span class="n">try_catch</span><span class="o">&lt;</span><span class="n">CatchT</span><span class="o">></span><span class="p">())</span> <span class="p">{</span>
    <span class="n">use</span><span class="p">(</span><span class="o">*</span><span class="n">ex</span><span class="p">);</span>
<span class="p">}</span>
</pre>
   <h4 class="heading settled" data-level="2.1.4" id="terminate_with_active"><span class="secno">2.1.4. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="terminate_with_active①">terminate_with_active()<dfn></dfn></dfn></span><a class="self-link" href="p1066r0.html#terminate_with_active"></a></h4>
<pre class="language-cpp highlight"><span class="p">[[</span><span class="n">noreturn</span><span class="p">]]</span> <span class="kt">void</span> <span class="n">terminate_with_active</span><span class="p">()</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
</pre>
   <p>Equivalent to:</p>
<pre class="language-cpp highlight"><span class="k">try</span> <span class="p">{</span>
    <span class="n">rethrow_exception</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="n">terminate</span><span class="p">();</span>
<span class="p">}</span>
</pre>
   <p>Invokes the terminate handler with the contained exception active to allow it to provide useful
information for debugging.</p>
   <p class="note" role="note"><span>Note:</span> I believe this definition is exactly equivalent to just calling <code class="highlight"><span class="n">rethrow_exception</span></code> inside a <code class="highlight"><span class="k">noexcept</span></code> context, but I wrote it that way to avoid bugs we’ve seen with <code class="highlight"><span class="k">noexcept</span></code>, particularly
when used for this purpose.</p>
   <h3 class="heading settled" data-level="2.2" id="low-level-api"><span class="secno">2.2. </span><span class="content">Low-level API</span><a class="self-link" href="p1066r0.html#low-level-api"></a></h3>
   <p>This is the low-level API that is intended for library authors building their own high-level API,
rather than direct use by end users.</p>
   <h4 class="heading settled" data-level="2.2.1" id="type"><span class="secno">2.2.1. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="type①">type()</dfn></span><a class="self-link" href="p1066r0.html#type"></a></h4>
<pre class="language-cpp highlight"><span class="n">type_info</span><span class="o">*</span> <span class="nf">type</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</pre>
   <p>Returns the <code class="highlight"><span class="n">type_info</span></code> corresponding to the exception held by this <code class="highlight"><span class="n">exception_ptr</span></code>.</p>
   <h4 class="heading settled" data-level="2.2.2" id="get_raw_ptr"><span class="secno">2.2.2. </span><span class="content"><dfn data-dfn-type="dfn" data-noexport="" id="get_raw_ptr①">get_raw_ptr()<a class="self-link" href="p1066r0.html#get_raw_ptr①"></a></dfn></span><a class="self-link" href="p1066r0.html#get_raw_ptr"></a></h4>
<pre class="language-cpp highlight"><span class="kt">void</span><span class="o">*</span> <span class="nf">get_raw_ptr</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</pre>
   <p>Returns the address of the exception held by this <code class="highlight"><span class="n">exception_ptr</span></code>. It is a pointer to the type
described by <a data-link-type="dfn" href="p1066r0.html#type①" id="ref-for-type①">type()</a>, so the caller will need to cast it to something compatible in order to use
this.</p>
   <h2 class="heading settled" data-level="3" id="use-cases"><span class="secno">3. </span><span class="content">Use Cases</span><a class="self-link" href="p1066r0.html#use-cases"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="lippincott-functions"><span class="secno">3.1. </span><span class="content">Lippincott Functions</span><a class="self-link" href="p1066r0.html#lippincott-functions"></a></h3>
   <p>Here is a lightly-modified example from our code base that shows a <strong>100x</strong> speedup on Linux:</p>
   <table>
    <thead>
     <tr>
      <th> Now 
      <th> With this proposal 
    <tbody>
     <tr>
      <td>
<pre class="language-cpp highlight"><span class="n">Status</span> <span class="nf">exceptionToStatus</span><span class="p">()</span> <span class="k">noexcept</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">throw</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">DBException</span><span class="o">&amp;</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">ex</span><span class="p">.</span><span class="n">toStatus</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Status</span><span class="p">(</span><span class="n">ErrorCodes</span><span class="o">::</span><span class="n">UnknownError</span><span class="p">,</span>
                  <span class="n">ex</span><span class="p">.</span><span class="n">what</span><span class="p">());</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
      <td>
<pre class="language-cpp highlight"><span class="n">Status</span> <span class="nf">exceptionToStatus</span><span class="p">()</span> <span class="k">noexcept</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">current_exeption</span><span class="p">().</span><span class="n">handle_or_terminate</span><span class="p">(</span>
    <span class="p">[]</span> <span class="p">(</span><span class="k">const</span> <span class="n">DBException</span><span class="o">&amp;</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">ex</span><span class="p">.</span><span class="n">toStatus</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="p">[]</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">Status</span><span class="p">(</span><span class="n">ErrorCodes</span><span class="o">::</span><span class="n">UnknownError</span><span class="p">,</span>
                    <span class="n">ex</span><span class="p">.</span><span class="n">what</span><span class="p">());</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre>
     <tr>
      <td>
       <center> 1892ns </center>
      <td>
       <center> 18ns </center>
   </table>
   <p>Windows shows <em>only</em> a 2x speedup (1488ns -> 1744ns) due to the <a data-link-type="dfn" href="p1066r0.html#decodepointer" id="ref-for-decodepointer">DecodePointer()</a> issue mentioned
above (160ns), as well as <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">current_exeption</span><span class="p">()</span></code> being even slower (575ns). Essentially all of
the runtime is in those two functions. (Windows tests were conducted on different hardware, so the
results cannot be directly compared to Linux.)</p>
   <h3 class="heading settled" data-level="3.2" id="terminate-handlers"><span class="secno">3.2. </span><span class="content">Terminate Handlers</span><a class="self-link" href="p1066r0.html#terminate-handlers"></a></h3>
   <p>It is common practice to use terminate handlers to provide useful debugging information about the
failure. libstdc++ has a default handler that prints the type of the thrown exception using it’s
privileged access to the EH internals. Unfortunately, there is no way to do that in the general case
in a user-defined terminate handler. <a data-link-type="dfn" href="p1066r0.html#type①" id="ref-for-type①①">type()</a> makes that information available from <code class="highlight"><span class="n">current_exception</span></code> in a portable way.</p>
   <p>As a historical sidenote, that message from the terminate handler is what initially got me looking
into the ABI for exception handling to figure out how that was done. If whoever wrote that code is
reading this, thanks!</p>
   <h3 class="heading settled" data-level="3.3" id="stdexpected-and-similar-types"><span class="secno">3.3. </span><span class="content"><code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">expected</span></code> and Similar Types</span><a class="self-link" href="p1066r0.html#stdexpected-and-similar-types"></a></h3>
   <p>These types become more useful with the ability to interact with the exception directly without
rethrowing.</p>
   <h3 class="heading settled" data-level="3.4" id="error-handling-in-futures"><span class="secno">3.4. </span><span class="content">Error Handling in Futures</span><a class="self-link" href="p1066r0.html#error-handling-in-futures"></a></h3>
   <p>Error handling in Future chains naturally involves passing error objects into callbacks as
arguments. There has been an active <a href="https://github.com/executors/futures/issues/37">discussion</a> around avoiding <code class="highlight"><span class="n">exception_ptr</span></code> due to these issues. In addition to the direct performance benefits
of avoiding the unwinder, this also makes it easier to provide nicer APIs like <code class="highlight"><span class="n">future</span><span class="p">.</span><span class="n">catch_error</span><span class="p">([](</span><span class="n">SomeExceptionType</span><span class="o">&amp;</span><span class="p">)</span> <span class="p">{})</span></code> that only invokes the user’s callback when the types
match. This has a secondary benefit of avoiding a trip through the executor’s scheduler if the
callback isn’t to be called. It also has the (unconfirmed) potential of being implementable on GPUs
which don’t currently support exceptions.</p>
   <h2 class="heading settled" data-level="4" id="it-sounds-like-you-just-want-faster-exception-handling-why-isnt-this-just-a-qoi-issue"><span class="secno">4. </span><span class="content">It sounds like you just want faster exception handling. Why isn’t this just a QoI issue?</span><a class="self-link" href="p1066r0.html#it-sounds-like-you-just-want-faster-exception-handling-why-isnt-this-just-a-qoi-issue"></a></h2>
   <p>It has been 30 years since C++98 was finalized. Compilers seem to actively avoid optimizing for
speed in codepaths that involve throwing, which is usually a good choice. But this means that even
in trivial cases, they aren’t able to work their usual magic. Here is an example function that
should be reduced to a constant value of <code class="highlight"><span class="mi">0</span></code>, but instead goes through the full <code class="highlight"><span class="k">throw</span></code>/<code class="highlight"><span class="k">catch</span></code> process on all 3 major compilers. On my Linux desktop that means it takes 5600 cycles, when it
should take none.</p>
<pre class="language-cpp highlight"><span class="kt">int</span> <span class="nf">shouldBeTrivial</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">ex</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>
</pre>
   <p>Given how universal the poor handling of exceptions is, I don’t see much hope for improvement to the
extent proposed here in the realistic, non-trivial cases. Additionally, I think the ergonomics are
better if the exception object is made directly available than requiring the <code class="highlight"><span class="k">try</span></code>/<code class="highlight"><span class="k">catch</span></code> blocks.</p>
   <h2 class="heading settled" data-level="5" id="related-future-work"><span class="secno">5. </span><span class="content">Related Future Work</span><a class="self-link" href="p1066r0.html#related-future-work"></a></h2>
   <p>These are related ideas that are <strong>not</strong> part of this proposal. If this proposal is well received,
I’d like a straw poll of these to gauge the interest for future proposals.</p>
   <h3 class="heading settled" data-level="5.1" id="support-dynamic-dynamic_cast-using-type_info"><span class="secno">5.1. </span><span class="content">Support dynamic <code class="highlight"><span class="k">dynamic_cast</span></code> using <code class="highlight"><span class="n">type_info</span></code></span><a class="self-link" href="p1066r0.html#support-dynamic-dynamic_cast-using-type_info"></a></h3>
   <p>My initial implementation plan called for adding casting facilities to <code class="highlight"><span class="n">type_info</span></code> and building the <a data-link-type="dfn" href="p1066r0.html#try_catch①" id="ref-for-try_catch①">try_catch()</a> logic on top of that. Since it ended up being the wrong route for the MSVC ABI, I
abandoned that plan, but it still provides useful independent functionality. Something like adding
the following methods on <code class="highlight"><span class="n">type_info</span></code>:</p>
<pre class="language-cpp highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">></span>
<span class="kt">bool</span> <span class="n">convertable_to</span><span class="p">()</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">></span>
<span class="n">T</span><span class="o">*</span> <span class="n">dynamic_dynamic_cast</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">ptr</span><span class="p">);</span>
</pre>
   <h3 class="heading settled" data-level="5.2" id="dynamic_any_cast"><span class="secno">5.2. </span><span class="content"><code class="highlight"><span class="n">dynamic_any_cast</span></code></span><a class="self-link" href="p1066r0.html#dynamic_any_cast"></a></h3>
   <p>Currently <code class="highlight"><span class="n">any</span></code> only supports exact-match casting. Using a similarly enhanced <code class="highlight"><span class="n">type_info</span></code> it should
be able to support more flexible extractions.</p>
   <h3 class="heading settled" data-level="5.3" id="less-copies-in-stdmake_exception_ptr-e-e"><span class="secno">5.3. </span><span class="content">Less copies in <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">make_exception_ptr</span><span class="p">(</span><span class="n">E</span> <span class="n">e</span><span class="p">)</span></code></span><a class="self-link" href="p1066r0.html#less-copies-in-stdmake_exception_ptr-e-e"></a></h3>
   <p>I noticed that the current definition takes the exception by value and is defined as copying it.
Should it take the exception object by forwarding reference and forward it? If consensus is yes, I’d
be happy to either submit a new paper or just add that to the proposed wording here.</p>
  </main>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="p1066r0.html#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="p1066r0.html#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="p1066r0.html#decodepointer">DecodePointer()</a><span>, in §1</span>
   <li><a href="p1066r0.html#get_raw_ptr①">get_raw_ptr()</a><span>, in §2.2.2</span>
   <li><a href="p1066r0.html#handle①">handle()</a><span>, in §2.1.1</span>
   <li><a href="p1066r0.html#handle_or_terminate①">handle_or_terminate()</a><span>, in §2.1.2</span>
   <li><a href="p1066r0.html#terminate_with_active①">terminate_with_active()</a><span>, in §2.1.4</span>
   <li><a href="p1066r0.html#try_catch①">try_catch()</a><span>, in §2.1.3</span>
   <li><a href="p1066r0.html#type①">type()</a><span>, in §2.2.1</span>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="p1066r0.html#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="p1066r0.html#informative"></a></h3>
  <dl>
   <dt id="biblio-n4282">[N4282]
   <dd>Walter E. Brown. <a href="https://wg21.link/n4282">A Proposal for the World's Dumbest Smart Pointer, v4</a>. 7 November 2014. URL: <a href="https://wg21.link/n4282">https://wg21.link/n4282</a>
  </dl>
  <aside class="dfn-panel" data-for="decodepointer">
   <b><a href="p1066r0.html#decodepointer">#decodepointer</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="p1066r0.html#ref-for-decodepointer">3.1. Lippincott Functions</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle①">
   <b><a href="p1066r0.html#handle①">#handle①</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="p1066r0.html#ref-for-handle①">2.1.2. handle_or_terminate()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="try_catch①">
   <b><a href="p1066r0.html#try_catch①">#try_catch①</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="p1066r0.html#ref-for-try_catch①">5.1. Support dynamic dynamic_cast using type_info</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="terminate_with_active①">
   <b><a href="p1066r0.html#terminate_with_active①">#terminate_with_active①</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="p1066r0.html#ref-for-terminate_with_active①">2.1.2. handle_or_terminate()</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="type①">
   <b><a href="p1066r0.html#type①">#type①</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="p1066r0.html#ref-for-type①">2.2.2. get_raw_ptr()</a>
    <li><a href="p1066r0.html#ref-for-type①①">3.2. Terminate Handlers</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>