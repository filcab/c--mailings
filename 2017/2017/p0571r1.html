<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>p0571r1: Type Requirements for &lt;numeric> Algorithms</title>
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="p0571r1.html#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: medium;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red !important;  background-color: #FFB0B0; text-decoration: line-through; }
	ins { color: #080 !important; background-color: #B0FFB0; text-decoration: none;         }

	del code, del pre, .del code, .del pre, code del, pre del, code .del, pre .del { background-color: #FFB0B0 !important; text-decoration: line-through; }
	ins code, ins pre, .ins code, .ins pre, code ins, pre ins, code .ins, pre .ins { background-color: #B0FFB0 !important; text-decoration: none;         }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
		border-bottom-width: 3px !important;
		margin-bottom: 0px !important;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li li { font-size:   85%;    }

	.toc > li             { margin: 1.5rem 0;    }
	.toc > li li          { margin: 0.3rem 0;    }
	.toc > li li li       { margin-left: 2rem;   }

	/* Section numbers in a column of their own */
	.toc .secno {
		float: left;
		width: 4rem;
		white-space: nowrap;
	}
	.toc > li li li li .secno {
		font-size: 85%;
	}
	.toc > li li li li li .secno {
		font-size: 100%;
	}

	:not(li) > .toc              { margin-left:  5rem; }
	.toc .secno                  { margin-left: -5rem; }
	.toc > li li li .secno       { margin-left: -7rem; }
	.toc > li li li li .secno    { margin-left: -9rem; }
	.toc > li li li li li .secno { margin-left: -11rem; }

	/* Tighten up indentation in narrow ToCs */
	@media (max-width: 30em) {
		:not(li) > .toc              { margin-left:  4rem; }
		.toc .secno                  { margin-left: -4rem; }
		.toc > li li li              { margin-left:  1rem; }
		.toc > li li li .secno       { margin-left: -5rem; }
		.toc > li li li li .secno    { margin-left: -6rem; }
		.toc > li li li li li .secno { margin-left: -7rem; }
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
		body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
		body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
		body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
		body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
		body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	body.toc-sidebar #toc :not(li) > .toc              { margin-left:  4rem; }
	body.toc-sidebar #toc .toc .secno                  { margin-left: -4rem; }
	body.toc-sidebar #toc .toc > li li li              { margin-left:  1rem; }
	body.toc-sidebar #toc .toc > li li li .secno       { margin-left: -5rem; }
	body.toc-sidebar #toc .toc > li li li li .secno    { margin-left: -6rem; }
	body.toc-sidebar #toc .toc > li li li li li .secno { margin-left: -7rem; }

	.toc li {
		clear: both;
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-left: calc(13px + 26.5rem - 50vw);
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-left: calc(40em - 50vw) !important;
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-left: 0 !important;
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed version ba473502a120361710488ab9b7f538b47858631e" name="generator">
  <link href="http://wg21.link/P0571r1" rel="canonical">
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-hidedel */

            #hidedel:checked ~ del, #hidedel:checked ~ * del { display:none; }
            #hidedel ~ #hidedel-label::before, #hidedel ~ * #hidedel-label::before { content: "☐ "; }
            #hidedel:checked ~ #hidedel-label::before, #hidedel:checked ~ * #hidedel-label::before { content: "☑ "; }
        </style>
<style>/* style-selflinks */

.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: gray;
    color: white;
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: black;
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: #005a9c;
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-syntax-highlighting */

.highlight:not(.idl) { background: hsl(24, 20%, 95%); }
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
.highlight .c { color: #708090 } /* Comment */
.highlight .k { color: #990055 } /* Keyword */
.highlight .l { color: #000000 } /* Literal */
.highlight .n { color: #0077aa } /* Name */
.highlight .o { color: #999999 } /* Operator */
.highlight .p { color: #999999 } /* Punctuation */
.highlight .cm { color: #708090 } /* Comment.Multiline */
.highlight .cp { color: #708090 } /* Comment.Preproc */
.highlight .c1 { color: #708090 } /* Comment.Single */
.highlight .cs { color: #708090 } /* Comment.Special */
.highlight .kc { color: #990055 } /* Keyword.Constant */
.highlight .kd { color: #990055 } /* Keyword.Declaration */
.highlight .kn { color: #990055 } /* Keyword.Namespace */
.highlight .kp { color: #990055 } /* Keyword.Pseudo */
.highlight .kr { color: #990055 } /* Keyword.Reserved */
.highlight .kt { color: #990055 } /* Keyword.Type */
.highlight .ld { color: #000000 } /* Literal.Date */
.highlight .m { color: #000000 } /* Literal.Number */
.highlight .s { color: #a67f59 } /* Literal.String */
.highlight .na { color: #0077aa } /* Name.Attribute */
.highlight .nc { color: #0077aa } /* Name.Class */
.highlight .no { color: #0077aa } /* Name.Constant */
.highlight .nd { color: #0077aa } /* Name.Decorator */
.highlight .ni { color: #0077aa } /* Name.Entity */
.highlight .ne { color: #0077aa } /* Name.Exception */
.highlight .nf { color: #0077aa } /* Name.Function */
.highlight .nl { color: #0077aa } /* Name.Label */
.highlight .nn { color: #0077aa } /* Name.Namespace */
.highlight .py { color: #0077aa } /* Name.Property */
.highlight .nt { color: #669900 } /* Name.Tag */
.highlight .nv { color: #222222 } /* Name.Variable */
.highlight .ow { color: #999999 } /* Operator.Word */
.highlight .mb { color: #000000 } /* Literal.Number.Bin */
.highlight .mf { color: #000000 } /* Literal.Number.Float */
.highlight .mh { color: #000000 } /* Literal.Number.Hex */
.highlight .mi { color: #000000 } /* Literal.Number.Integer */
.highlight .mo { color: #000000 } /* Literal.Number.Oct */
.highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
.highlight .sc { color: #a67f59 } /* Literal.String.Char */
.highlight .sd { color: #a67f59 } /* Literal.String.Doc */
.highlight .s2 { color: #a67f59 } /* Literal.String.Double */
.highlight .se { color: #a67f59 } /* Literal.String.Escape */
.highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
.highlight .si { color: #a67f59 } /* Literal.String.Interpol */
.highlight .sx { color: #a67f59 } /* Literal.String.Other */
.highlight .sr { color: #a67f59 } /* Literal.String.Regex */
.highlight .s1 { color: #a67f59 } /* Literal.String.Single */
.highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
.highlight .vc { color: #0077aa } /* Name.Variable.Class */
.highlight .vg { color: #0077aa } /* Name.Variable.Global */
.highlight .vi { color: #0077aa } /* Name.Variable.Instance */
.highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
</style>
 <body class="h-entry">
  <input id="hidedel" style="display:none" type="checkbox">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">p0571r1<br>Type Requirements for &lt;numeric> Algorithms</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Draft Proposal, <time class="dt-updated" datetime="2017-02-02">2 February 2017</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="http://wg21.link/P0571r1">http://wg21.link/P0571r1</a>
     <dt>Author:
     <dd>
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:brycelelbach@gmail.com">Bryce Adelstein Lelbach</a> (<span class="p-org org">Lawrence Berkeley National Laboratory</span>)
     <dt>Audience:
     <dd>SG1, LEWG, LWG
     <dt>Toggle Diffs:
     <dd>
      <label for="hidedel" id="hidedel-label">Hide deleted text</label>
     <dt>Project:
     <dd>ISO JTC1/SC22/WG21: Programming Language C++
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <hr title="Separator for header">
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="p0571r1.html#overview"><span class="secno">1</span> <span class="content">Overview</span></a>
    <li>
     <a href="p0571r1.html#algorithm_kinds"><span class="secno">2</span> <span class="content">Kinds of Algorithms in <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code></span></a>
     <ol class="toc">
      <li><a href="p0571r1.html#in_order_accumulator"><span class="secno">2.1</span> <span class="content">In-Order-Accumulator Algorithms</span></a>
      <li><a href="p0571r1.html#gnsum_and_gsum"><span class="secno">2.2</span> <span class="content"><code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code> and <code class="highlight"><span class="n">GENERALIZED_SUM</span></code> Algorithms</span></a>
     </ol>
    <li>
     <a href="p0571r1.html#intermediate"><span class="secno">3</span> <span class="content">What Should the Intermediate Type Be?</span></a>
     <ol class="toc">
      <li><a href="p0571r1.html#intermediate_ordered_ivp"><span class="secno">3.1</span> <span class="content">Intermediate Type for Ordered <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> Algorithms with Initial Value Parameters</span></a>
      <li><a href="p0571r1.html#intermediate_ordered_noivp"><span class="secno">3.2</span> <span class="content">Intermediate Type for Ordered <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> Algorithms without Initial Value Parameters</span></a>
      <li><a href="p0571r1.html#intermediate_unordered"><span class="secno">3.3</span> <span class="content">Intermediate Type for Unordered <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> Algorithms</span></a>
      <li><a href="p0571r1.html#intermediate_policy"><span class="secno">3.4</span> <span class="content">Intermediate Type Policy for <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> Algorithms</span></a>
     </ol>
    <li><a href="p0571r1.html#type_reqs"><span class="secno">4</span> <span class="content">Type Requirements</span></a>
    <li><a href="p0571r1.html#proposed_changes"><span class="secno">5</span> <span class="content">Proposed Changes</span></a>
    <li>
     <a href="p0571r1.html#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="p0571r1.html#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="overview"><span class="secno">1. </span><span class="content">Overview</span><a class="self-link" href="p0571r1.html#overview"></a></h2>
   <p>At the Issaquah 2016 meeting, during the LWG review of <a data-link-type="biblio" href="p0571r1.html#biblio-p0452r0">[P0452r0]</a>, it was
realized that some of the numeric algorithms (both old algorithms and new ones
from the Parallelism TS) had insufficient or unclear type requirements.
This paper identifies some of the issues and proposes potential solutions.</p>
   <p><b><a href="http://i.imgur.com/4DyiKDv.png">This chart</a></b> provides an
overview of the current state of the type requirements of the <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> algorithms.</p>
   <p><b>This proposal is not intended to change the existing design, specify any
previous unspecified behavior which major implementations do not already
conform to, or remove functionality. It simply clarifies and improves the
specification of the <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> algorithms.</b></p>
   <h2 class="heading settled" data-level="2" id="algorithm_kinds"><span class="secno">2. </span><span class="content">Kinds of Algorithms in <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code></span><a class="self-link" href="p0571r1.html#algorithm_kinds"></a></h2>
   <p>There are three kinds of algorithms in <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code>:</p>
   <ul>
    <li data-md="">
     <p><code class="highlight"><span class="n">accumulate</span></code>, <code class="highlight"><span class="n">inner_product</span></code>, <code class="highlight"><span class="n">partial_sum</span></code> and <code class="highlight"><span class="n">adjacent_difference</span></code> have "in-order-accumulator" style wording.</p>
    <li data-md="">
     <p><code class="highlight"><span class="n">exclusive_scan</span></code>, <code class="highlight"><span class="n">inclusive_scan</span></code>, <code class="highlight"><span class="n">transform_exclusive_scan</span></code>, <code class="highlight"><span class="n">transform_inclusive_scan</span></code> are specified using <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code>.</p>
    <li data-md="">
     <p><code class="highlight"><span class="n">reduce</span></code>, <code class="highlight"><span class="n">transform_reduce</span></code> are specified via <code class="highlight"><span class="n">GENERALIZED_SUM</span></code>.</p>
   </ul>
   <h3 class="heading settled" data-level="2.1" id="in_order_accumulator"><span class="secno">2.1. </span><span class="content">In-Order-Accumulator Algorithms</span><a class="self-link" href="p0571r1.html#in_order_accumulator"></a></h3>
   <p>The wording for all of these algorithms fits the following pattern:</p>
   <ul>
    <li data-md="">
     <p>Create an <code class="highlight"><span class="n">acc</span></code> object which is initialized with <code class="highlight"><span class="n">init</span></code> if the algorithm
signature contains an initial value parameter and <code class="highlight"><span class="o">*</span><span class="n">first</span></code> otherwise.</p>
    <li data-md="">
     <p>For (the) iterator(s) in the range(s) <strong>in order</strong>, modify <code class="highlight"><span class="n">acc</span></code> by applying
a binary update operation which takes <code class="highlight"><span class="n">acc</span></code> and the dereferenced value(s)
of the iterator(s) as arguments: e.g. <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">binary_op</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span></code>.</p>
   </ul>
   <p>The ordering requirement is necessary to ensure that these algorithms are
well-defined for <strong>non-associative</strong> and/or <strong>non-commutative</strong> operations, such as
floating-point addition and multiplication (non-associative and commutative),
and subtraction (non-associative and non-commutative).</p>
   <p>Currently, the wording forces each iteration to depend on the prior iteration
to ensure the correct ordering of accumulation. This introduces a loop-carried
dependency that makes it impossible to parallelize.</p>
   <h3 class="heading settled" data-level="2.2" id="gnsum_and_gsum"><span class="secno">2.2. </span><span class="content"><code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code> and <code class="highlight"><span class="n">GENERALIZED_SUM</span></code> Algorithms</span><a class="self-link" href="p0571r1.html#gnsum_and_gsum"></a></h3>
   <p>To parallelize these operations, we need to be able to re-order applications of
the operations, partition the workload into sub-tasks and then combine the
results of the sub-tasks together using the operator.</p>
   <p>This, however, would give a non-deterministic result for non-associative or
non-commutative operations; for example, floating point arithmetic.</p>
   <p>In addition to adding entirely new <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> algorithms, the
Parallelism TS introduced new algorithms which perform the same operations as <code class="highlight"><span class="n">accumulate</span></code>, <code class="highlight"><span class="n">inner_product</span></code> and <code class="highlight"><span class="n">partial_sum</span></code>, but have weaker constraints
that allow parallelization:</p>
   <ul>
    <li data-md="">
     <p><code class="highlight"><span class="n">reduce</span></code> is a parallelizable variant of <code class="highlight"><span class="n">accumulate</span></code> and <code class="highlight"><span class="n">transform_reduce</span></code> is
a parallelizable variant <code class="highlight"><span class="n">inner_product</span></code>. They may produce non-deterministic
results for non-associative or non-commutative operations.</p>
    <li data-md="">
     <p><code class="highlight"><span class="n">inclusive_scan</span></code> is a parallelizable variant of <code class="highlight"><span class="n">partial_sum</span></code>. It may produce
non-deterministic results for non-associative operations, but is fine for
non-commutative operations.</p>
   </ul>
   <p>These <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> algorithms are specified using the <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code> and <code class="highlight"><span class="n">GENERALIZED_SUM</span></code> definitions:</p>
   <blockquote>
     <strong>26.2 Definitions</strong> [<strong>numerics.defns</strong>] 
    <p>1 Define <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span><span class="p">)</span></code> as follows:</p>
    <ul>
     <li data-md="">
      <p><code class="highlight"><span class="n">a1</span></code> when <code class="highlight"><span class="n">N</span></code> is <code class="highlight"><span class="mi">1</span></code>, otherwise</p>
     <li data-md="">
      <p><code class="highlight"><span class="n">op</span><span class="p">(</span><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aK</span><span class="p">),</span> <span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">aM</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span><span class="p">))</span></code> for any <code class="highlight"><span class="n">K</span></code> where <code class="highlight"><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">K</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">M</span> ≤ <span class="n">N</span></code>.</p>
    </ul>
    <p>2 Define <code class="highlight"><span class="n">GENERALIZED_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span><span class="p">)</span></code> as <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">bN</span><span class="p">)</span></code> where <code class="highlight"><span class="n">b1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">bN</span></code> may be any permutation of <code class="highlight"><span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span></code>.</p>
   </blockquote>
   <p>This definition allows:</p>
   <ul>
    <li data-md="">
     <p>Arbitrary, nested partitioning of input elements for both <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code> and <code class="highlight"><span class="n">GENERALIZED_SUM</span></code>.</p>
    <li data-md="">
     <p>Arbitrary reordering of input elements for <code class="highlight"><span class="n">GENERALIZED_SUM</span></code>.</p>
   </ul>
   <h2 class="heading settled" data-level="3" id="intermediate"><span class="secno">3. </span><span class="content">What Should the Intermediate Type Be?</span><a class="self-link" href="p0571r1.html#intermediate"></a></h2>
   <p>During computation of the final result, a <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> algorithm needs to store the result of accumulation thus far in temporary
objects. The <strong>intermediate type</strong> is the type of these objects. Importantly,
these temporary objects are passed as the first argument to the binary
operator. For the accumulator-style <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> algorithms
(<code class="highlight"><span class="n">accumulate</span></code>, <code class="highlight"><span class="n">inner_product</span></code>, <code class="highlight"><span class="n">partial_sum</span></code>, <code class="highlight"><span class="n">adjacent_difference</span></code>), the
intermediate type is the type of the accumulator object <code class="highlight"><span class="n">acc</span></code>.</p>
   <p>The intermediate type is only clearly specified for 2 of the 10 <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> algorithms. Determining and specifiying the
intermediate type for these algorithms is our first step because the type
requirements all revolve around the intermediate type.</p>
   <h3 class="heading settled" data-level="3.1" id="intermediate_ordered_ivp"><span class="secno">3.1. </span><span class="content">Intermediate Type for Ordered <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> Algorithms with Initial Value Parameters</span><a class="self-link" href="p0571r1.html#intermediate_ordered_ivp"></a></h3>
   <p><code class="highlight"><span class="n">accumulate</span></code> and <code class="highlight"><span class="n">inner_product</span></code> are described by the standard as:</p>
   <blockquote>
     <strong>26.8.2 Accumulate</strong> [<strong>accumulate</strong>]: 
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="o">></span>
  <span class="n">T</span> <span class="n">accumulate</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
               <span class="n">T</span> <span class="n">init</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="o">></span>
  <span class="n">T</span> <span class="n">accumulate</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
               <span class="n">T</span> <span class="n">init</span><span class="p">,</span>
               <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">);</span>
</pre>
    <p>1 <em>Effects:</em> Computes its result by initializing the accumulator <code class="highlight"><span class="n">acc</span></code> with the initial value <code class="highlight"><span class="n">init</span></code> and then modifies it with <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="o">+</span> <span class="o">*</span><span class="n">i</span></code> or <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">binary_op</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span></code> for every iterator <code class="highlight"><span class="n">i</span></code> in the range <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span></code> in order.</p>
    <p>2 <em>Requires:</em> <code class="highlight"><span class="n">T</span></code> shall meet the requirements of <code class="highlight"><span class="n">CopyConstructible</span></code> (Table 22) and <code class="highlight"><span class="n">CopyAssignable</span></code> (Table 24) types. In the range <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">]</span></code>, <code class="highlight"><span class="n">binary_op</span></code> shall neither modify elements nor invalidate iterators or subranges.</p>
   </blockquote>
   <blockquote>
     <strong>26.8.5 Inner product</strong> [<strong>inner.product</strong>]: 
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator1</span><span class="p">,</span> <span class="k">class</span> <span class="nc">InputIterator2</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="o">></span>
  <span class="n">T</span> <span class="n">inner_product</span><span class="p">(</span><span class="n">InputIterator1</span> <span class="n">first1</span><span class="p">,</span> <span class="n">InputIterator1</span> <span class="n">last1</span><span class="p">,</span>
                  <span class="n">InputIterator2</span> <span class="n">first2</span><span class="p">,</span>
                  <span class="n">T</span> <span class="n">init</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator1</span><span class="p">,</span> <span class="k">class</span> <span class="nc">InputIterator2</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation1</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation2</span><span class="o">></span>
  <span class="n">T</span> <span class="n">inner_product</span><span class="p">(</span><span class="n">InputIterator1</span> <span class="n">first1</span><span class="p">,</span> <span class="n">InputIterator1</span> <span class="n">last1</span><span class="p">,</span>
                  <span class="n">InputIterator2</span> <span class="n">first2</span><span class="p">,</span>
                  <span class="n">T</span> <span class="n">init</span><span class="p">,</span>
                  <span class="n">BinaryOperation1</span> <span class="n">binary_op1</span><span class="p">,</span>
                  <span class="n">BinaryOperation2</span> <span class="n">binary_op2</span><span class="p">);</span>
</pre>
    <p>1 <em>Effects:</em> Computes its result by initializing the accumulator <code class="highlight"><span class="n">acc</span></code> with the initial value <code class="highlight"><span class="n">init</span></code> and then modifying it with <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">i1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">i2</span><span class="p">)</span></code> or <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">binary_op1</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="n">binary_op2</span><span class="p">(</span><span class="o">*</span><span class="n">i1</span><span class="p">,</span> <span class="o">*</span><span class="n">i2</span><span class="p">))</span></code> for every iterator <code class="highlight"><span class="n">i1</span></code> in the range <code class="highlight"><span class="p">[</span><span class="n">first1</span><span class="p">,</span> <span class="n">last1</span><span class="p">)</span></code> and iterator <code class="highlight"><span class="n">i2</span></code> in the range <code class="highlight"><span class="p">[</span><span class="n">first2</span><span class="p">,</span> <span class="n">first2</span> <span class="o">+</span> <span class="p">(</span><span class="n">last1</span> <span class="o">-</span> <span class="n">first1</span><span class="p">))</span></code> in order.</p>
    <p>2 <em>Requires:</em> <code class="highlight"><span class="n">T</span></code> shall meet the requirements of <code class="highlight"><span class="n">CopyConstructible</span></code> (Table 22) and <code class="highlight"><span class="n">CopyAssignable</span></code> (Table 24) types. In the ranges <code class="highlight"><span class="p">[</span><span class="n">first1</span><span class="p">,</span> <span class="n">last1</span><span class="p">]</span></code> and <code class="highlight"><span class="p">[</span><span class="n">first2</span><span class="p">,</span> <span class="n">first2</span> <span class="o">+</span> <span class="p">(</span><span class="n">last1</span> <span class="o">-</span> <span class="n">first1</span><span class="p">)]</span></code> <code class="highlight"><span class="n">binary_op1</span></code> and <code class="highlight"><span class="n">binary_op2</span></code> shall neither modify elements nor invalidate iterators or subranges.</p>
   </blockquote>
   <p>This definition doesn’t make it clear what the intermediate type is.
Both algorithms have a requirement that the type of the initial value
parameter (<code class="highlight"><span class="n">T</span></code>) be <code class="highlight"><span class="n">CopyConstructible</span></code> and <code class="highlight"><span class="n">CopyAssignable</span></code>, implying that the
accumulator object is intended to be of type <code class="highlight"><span class="n">T</span></code>. Both libc++ and libstdc++
use <code class="highlight"><span class="n">T</span></code> as the type of the accumulator object for these 2 algorithms.</p>
   <p>Using <code class="highlight"><span class="n">T</span></code> both has upsides:</p>
<pre class="highlight"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">></span> <span class="n">i</span><span class="p">{</span><span class="n">INT_MAX</span><span class="p">,</span> <span class="n">INT_MAX</span><span class="p">};</span>
<span class="n">big_int</span> <span class="n">bi</span> <span class="o">=</span> <span class="n">accumulate</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">d</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">big_int</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="c1">// big_int is an arbitrary-precision integer class which uses dynamic storage.</span>
<span class="c1"></span>
<span class="c1">// bi == 2 * INT_MAX.</span>
</pre>
   <p>and downsides:</p>
<pre class="highlight"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">></span> <span class="n">d</span><span class="p">{</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">};</span>
<span class="kt">double</span> <span class="n">r</span> <span class="o">=</span> <span class="n">accumulate</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">d</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">// r == 0, not 1. The accumulator’s type was int, since the type of the literal</span>
<span class="c1">// 0 is int.</span>
</pre>
   <p>Alternative choices for the intermediate type are:</p>
   <ul>
    <li data-md="">
     <p>Determine some common type between <code class="highlight"><span class="n">T</span></code>, <code class="highlight"><span class="n">InputIterator</span></code>'s value type, and
the result of <code class="highlight"><span class="n">binary_op</span></code> (or the relevant operator) and use that as the
intermediate type. As discussed in <a href="p0571r1.html#intermediate_ordered_noivp">§3.2 Intermediate Type for Ordered &lt;numeric> Algorithms without Initial Value Parameters</a>, it may be
difficult to do this if binary_op is overloaded in a certain manner and it
may make it harder for users to determine what the intermediate type will be.</p>
    <li data-md="">
     <p>Use the <code class="highlight"><span class="n">InputIterator</span></code>'s value type as the intermediate type. This would make
the example of accumulating a <code class="highlight"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">></span></code> produce a result that might
be closer to what the user intended, but it would also remove the
functionality desired by the user in the <code class="highlight"><span class="n">big_int</span></code> example.</p>
   </ul>
   <p>Switching to either of these alternatives would force implementations to make
breaking changes, and neither option seems particular attractive.</p>
   <p>I suggest adopting the following design. It is simple and clear to both users
and implementators:</p>
   <blockquote><b> <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> algorithms which take an initial value parameter
and initial value type template parameter will use the initial value type as
the intermediate type. </b></blockquote>
   <h3 class="heading settled" data-level="3.2" id="intermediate_ordered_noivp"><span class="secno">3.2. </span><span class="content">Intermediate Type for Ordered <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> Algorithms without Initial Value Parameters</span><a class="self-link" href="p0571r1.html#intermediate_ordered_noivp"></a></h3>
   <p>As we mentioned earlier, the type of the accumulator object (the intermediate
type) is explicitly specified for only 2 of the 10 <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> algorithms: <code class="highlight"><span class="n">partial_sum</span></code> and <code class="highlight"><span class="n">adjacent_difference</span></code>:</p>
   <blockquote>
     <strong>26.8.6 Partial sum</strong> [<strong>partial.sum</strong>] 
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">partial_sum</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                             <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">partial_sum</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                             <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">,</span>
                             <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">);</span>
</pre>
    <p>1 <em>Effects:</em> For a non-empty range, the function creates an accumulator <code class="highlight"><span class="n">acc</span></code> whose type is <code class="highlight"><span class="n">InputIterator</span></code>'s value type, initializes it with <code class="highlight"><span class="o">*</span><span class="n">first</span></code>, and assigns the result to <code class="highlight"><span class="o">*</span><span class="n">result</span></code>. For every iterator <code class="highlight"><span class="n">i</span></code> in <code class="highlight"><span class="p">[</span><span class="n">first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span></code> in order, <code class="highlight"><span class="n">acc</span></code> is then modified by <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="o">+</span> <span class="o">*</span><span class="n">i</span></code> or <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">binary_op</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span></code> and the result is assigned to <code class="highlight"><span class="o">*</span><span class="p">(</span><span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">first</span><span class="p">))</span></code>.</p>
    <p>2 <em>Returns:</em> <code class="highlight"><span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span></code>.</p>
    <p>3 <em>Complexity:</em> Exactly <code class="highlight"><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span></code> applications of the binary operation.</p>
    <p>4 <em>Requires:</em> <code class="highlight"><span class="n">InputIterator</span></code>'s value type shall be constructible from the type of <code class="highlight"><span class="o">*</span><span class="n">first</span></code>. The result of the expression <code class="highlight"><span class="n">acc</span> <span class="o">+</span> <span class="o">*</span><span class="n">i</span></code> or <code class="highlight"><span class="n">binary_op</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span></code> shall be implicitly convertible to <code class="highlight"><span class="n">InputIterator</span></code>'s value type. <code class="highlight"><span class="n">acc</span></code> shall be writable (24.2.1) to the <code class="highlight"><span class="n">result</span></code> output iterator. In the ranges <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">]</span></code> and <code class="highlight"><span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)]</span></code> <code class="highlight"><span class="n">binary_op</span></code> shall neither modify elements nor invalidate iterators or subranges.</p>
    <p>5 <em>Remarks:</em> <code class="highlight"><span class="n">result</span></code> may be equal to <code class="highlight"><span class="n">first</span></code>.</p>
   </blockquote>
   <blockquote>
     <strong>26.8.11 Adjacent difference</strong> [<strong>adjacent.difference</strong>] 
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">adjacent_difference</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                                     <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">adjacent_difference</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                                     <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">,</span>
                                     <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">);</span>
</pre>
    <p>1 <em>Effects:</em> For a non-empty range, the function creates an accumulator <code class="highlight"><span class="n">acc</span></code> whose type is <code class="highlight"><span class="n">InputIterator</span></code>'s value type, initializes it with <code class="highlight"><span class="o">*</span><span class="n">first</span></code>, and assigns the result to <code class="highlight"><span class="o">*</span><span class="n">result</span></code>. For every iterator <code class="highlight"><span class="n">i</span></code> in <code class="highlight"><span class="p">[</span><span class="n">first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span></code> in order, creates an object <code class="highlight"><span class="n">val</span></code> whose type is <code class="highlight"><span class="n">InputIterator</span></code>'s value type, initializes it with <code class="highlight"><span class="o">*</span><span class="n">i</span></code>, computes <code class="highlight"><span class="n">val</span> <span class="o">-</span> <span class="n">acc</span></code> or <code class="highlight"><span class="n">binary_op</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span></code>, assigns the result to <code class="highlight"><span class="o">*</span><span class="p">(</span><span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">first</span><span class="p">))</span></code>, and move assigns from <code class="highlight"><span class="n">val</span></code> to <code class="highlight"><span class="n">acc</span></code>.</p>
    <p>2 <em>Requires:</em> <code class="highlight"><span class="n">InputIterator</span></code>'s value type shall be <code class="highlight"><span class="n">MoveAssignable</span></code> (Table 23) and shall be constructible from the type of <code class="highlight"><span class="o">*</span><span class="n">first</span></code>. <code class="highlight"><span class="n">acc</span></code> shall be writable (24.2.1) to the <code class="highlight"><span class="n">result</span></code> output iterator. The result of the expression <code class="highlight"><span class="n">val</span> <span class="o">-</span> <span class="n">acc</span></code> or <code class="highlight"><span class="n">binary_op</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span></code> shall be writable to the <code class="highlight"><span class="n">result</span></code> output iterator. In the ranges <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">]</span></code> and <code class="highlight"><span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)]</span></code>, <code class="highlight"><span class="n">binary_op</span></code> shall neither modify elements nor invalidate iterators or subranges.</p>
    <p>3 <em>Remarks:</em> <code class="highlight"><span class="n">result</span></code> may be equal to <code class="highlight"><span class="n">first</span></code>.</p>
    <p>4 <em>Returns:</em> <code class="highlight"><span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span></code>.</p>
    <p>5 <em>Complexity:</em> Exactly <code class="highlight"><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span></code> applications of the binary operation.</p>
   </blockquote>
   <p>The only alternative to using <code class="highlight"><span class="n">InputIterator</span></code>'s value type for the intermediate
type that I could think of was computing the common type of the <code class="highlight"><span class="n">InputIterator</span></code>'s value type and the result of the right-hand side of the
repeated assignment to acc, e.g.</p>
<pre class="highlight"><span class="k">using</span> <span class="n">it_value_type</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">iterator_traits</span><span class="o">&lt;</span><span class="n">InputIterator</span><span class="o">>::</span><span class="n">value_type</span><span class="p">;</span>

<span class="c1">// The accumulator type, determined via common_type.</span>
<span class="c1"></span><span class="k">using</span> <span class="n">acc_common_type</span> <span class="o">=</span> <span class="n">common_type_t</span><span class="o">&lt;</span>
    <span class="n">it_value_type</span>
  <span class="p">,</span> <span class="k">decltype</span><span class="p">(</span><span class="n">binary_op</span><span class="p">(</span><span class="n">it_value_type</span><span class="p">{},</span> <span class="o">*</span><span class="n">i</span><span class="p">))</span>
    <span class="c1">// Or acc + *i, or acc - *i, etc. </span>
<span class="c1"></span><span class="o">></span>
</pre>
   <p>If the <code class="highlight"><span class="n">InputIterator</span></code>'s value type is convertible to the result of the binary
operator, but the result of the binary operator is not convertible to the <code class="highlight"><span class="n">InputIterator</span></code>'s value type, then the binary operator signature we tested with <code class="highlight"><span class="k">decltype</span></code> cannot be called with <code class="highlight"><span class="n">acc_common_type</span></code> as its first argument:</p>
<pre class="highlight"><span class="k">struct</span> <span class="n">A</span> <span class="p">{</span> <span class="p">};</span>
<span class="k">struct</span> <span class="n">B</span> <span class="p">{</span> <span class="k">operator</span> <span class="n">A</span><span class="p">();</span> <span class="p">};</span>

<span class="k">struct</span> <span class="n">binary_op_type</span>
<span class="p">{</span>
    <span class="n">A</span>   <span class="k">operator</span><span class="p">()</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
<span class="p">};</span>

<span class="n">binary_op_type</span> <span class="n">binary_op</span><span class="p">;</span>
 
<span class="k">using</span> <span class="n">it_value_type</span> <span class="o">=</span> <span class="n">B</span><span class="p">;</span> 

<span class="k">using</span> <span class="n">acc_common_type</span> <span class="o">=</span> <span class="n">common_type_t</span><span class="o">&lt;</span>
    <span class="n">it_value_type</span>
  <span class="p">,</span> <span class="k">decltype</span><span class="p">(</span><span class="n">binary_op</span><span class="p">(</span><span class="n">it_value_type</span><span class="p">{},</span> <span class="n">it_value_type</span><span class="p">{}))</span>
<span class="o">></span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">binary_op</span><span class="p">(</span><span class="n">acc_common_type</span><span class="p">{},</span> <span class="n">it_value_type</span><span class="p">{});</span> <span class="c1">// COMPILE FAIL.</span>
<span class="c1"></span><span class="p">}</span>
</pre>
   <p>Even worse, we could have a <code class="highlight"><span class="n">binary_op</span></code> like this:</p>
<pre class="highlight"><span class="k">struct</span> <span class="n">binary_op_type</span>
<span class="p">{</span>
    <span class="n">A</span>   <span class="k">operator</span><span class="p">()</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
    <span class="kt">int</span> <span class="nf">operator</span><span class="p">()</span> <span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
<span class="p">};</span>
</pre>
   <p>The above <code class="highlight"><span class="n">binary_op</span></code> can now be called with <code class="highlight"><span class="n">acc_common_type</span></code> as the first
argument, however that overload returns a different type which we did not
include in our common type computation. Nor could we have, as an iterative
TMP search for a common type would be dangerous in the face of potential
cycles:</p>
<pre class="highlight"><span class="k">struct</span> <span class="n">binary_op_type</span>
<span class="p">{</span>
    <span class="n">A</span>   <span class="k">operator</span><span class="p">()</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span> <span class="c1">// New expression binary_op(A{}, B{}) to check...</span>
<span class="c1"></span>    <span class="n">B</span>   <span class="nf">operator</span><span class="p">()</span> <span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span> <span class="c1">// New expression binary_op(B{}, B{}) to check...</span>
<span class="c1"></span><span class="p">};</span>
</pre>
   <p>This might be viable if we constrain <code class="highlight"><span class="n">binary_op</span></code> in some fashion, but it is not
clear to me how that could be done. More importantly, determining a common type
to use for the intermediate type is likely the wrong thing to do because it means
the user does not have a clear answer to the question "What type will you use to
perform the accumulation?".</p>
   <p>Since the <code class="highlight"><span class="n">OutputIterator</span></code> has no value type by virture of being an output
iterator, I cannot think of any other options for the intermediate type for the
algorithms without initial value parameters other than the status quo of the <code class="highlight"><span class="n">InputIterator</span></code>'s value type.</p>
   <p>There is, however, a regretable lack of functionality with the status quo prior
to C++17:</p>
<pre class="highlight"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">></span> <span class="n">f</span><span class="p">{</span><span class="n">FLT_MAX</span><span class="p">,</span> <span class="n">FLT_MAX</span><span class="p">};</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">></span> <span class="n">d</span><span class="p">;</span> 
<span class="n">partial_sum</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">f</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">back_inserter</span><span class="p">(</span><span class="n">d</span><span class="p">));</span> 
<span class="c1">// d[1] == inf since the intermediate type is float (the value type of</span>
<span class="c1">// vector&lt;float>::iterator).</span>
</pre>
   <p>Pre C++17, there is no way for users to specify that <code class="highlight"><span class="n">partial_sum</span></code> should use
a particular type as the intermediate type instead of the <code class="highlight"><span class="n">InputIterator</span></code>'s
value type. In C++17, there are two ways this can be done if ordered
is not needed. <code class="highlight"><span class="n">inclusive_scan</span></code>, the unordered counterpart of <code class="highlight"><span class="n">partial_sum</span></code>,
has overloads which take an initial value:</p>
<pre class="highlight"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">></span> <span class="n">f</span><span class="p">{</span><span class="n">FLT_MAX</span><span class="p">,</span> <span class="n">FLT_MAX</span><span class="p">};</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">></span> <span class="n">d</span><span class="p">;</span> 
<span class="n">inclusive_scan</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">f</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">back_inserter</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">plus</span><span class="o">&lt;></span><span class="p">{},</span> <span class="kt">double</span><span class="p">{</span><span class="mf">0.0</span><span class="p">});</span>
<span class="c1">// d[1] == 2 * FLT_MAX</span>
</pre>
   <p>or with <code class="highlight"><span class="n">transform_inclusive_scan</span></code> using a transform function that converts
its argument and returns the desire type:</p>
<pre class="highlight"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">></span> <span class="n">f</span><span class="p">{</span><span class="n">FLT_MAX</span><span class="p">,</span> <span class="n">FLT_MAX</span><span class="p">};</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">></span> <span class="n">d</span><span class="p">;</span> 
<span class="n">transform_inclusive_scan</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">f</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">back_inserter</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                       <span class="p">,</span> <span class="n">plus</span><span class="o">&lt;></span><span class="p">{}</span>
                       <span class="p">,</span> <span class="p">[](</span><span class="kt">float</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kt">double</span><span class="p">{</span><span class="n">f</span><span class="p">};</span> <span class="p">});</span>
<span class="c1">// d[1] == 6e38F.</span>
</pre>
   <p>A possible post-C++17 addition of <code class="highlight"><span class="n">partial_sum</span></code> signatures accepting an initial
value parameter would complete this functionality.</p>
   <p>I believe the best option is to keep the existing behavior for <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> algorithm which do not take an initial value
parameter.  Making any change to the type of the accumulator object would be a
breaking change as <code class="highlight"><span class="n">parital_sum</span></code> and <code class="highlight"><span class="n">adjacent_difference</span></code> are currently
specified to use accumulator objects whose type is the <code class="highlight"><span class="n">InputIterator</span></code>'s value
type, and none of the alternatives offer much benefit. The current behavior is
clear and easy to understand.</p>
   <p>So, I propose:</p>
   <blockquote><b> <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> algorithms which do not take an initial value
parameter and initial value type template parameter will use the value type of
their input iterator type as the intermediate type. </b></blockquote>
   <h3 class="heading settled" data-level="3.3" id="intermediate_unordered"><span class="secno">3.3. </span><span class="content">Intermediate Type for Unordered <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> Algorithms</span><a class="self-link" href="p0571r1.html#intermediate_unordered"></a></h3>
   <p>Unlike the ordered algorithms, the new unordered algorithms from the
Parallelism TS v1 do not use in-order-accumulator wording. Instead, they are
all specified in terms of <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code> and <code class="highlight"><span class="n">GENERALIZED_SUM</span></code> (<a href="p0571r1.html#gnsum_and_gsum">§2.2 GENERALIZED_NONCOMMUTATIVE_SUM and GENERALIZED_SUM Algorithms</a>).</p>
   <p>As an example of how these definitions are used, let’s take a look at <code class="highlight"><span class="n">reduce</span></code> (26.8.3 [<strong>reduce</strong>] paragraph 3):</p>
   <blockquote>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="o">></span>
  <span class="n">T</span> <span class="n">reduce</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
           <span class="n">T</span> <span class="n">init</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="o">></span>
  <span class="n">T</span> <span class="n">reduce</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
           <span class="n">T</span> <span class="n">init</span><span class="p">,</span>
           <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">);</span>
</pre>
    <p>3 <em>Returns:</em> <code class="highlight"><span class="n">GENERALIZED_SUM</span><span class="p">(</span><span class="n">binary_op</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="p">...)</span></code> for every <code class="highlight"><span class="n">i</span></code> in <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span></code></p>
   </blockquote>
   <p>These definitions do not clearly state what the intermediate type (e.g. the
return type of <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code> and <code class="highlight"><span class="n">GENERALIZED_SUM</span></code>) should
be.</p>
   <p>This is particularly scary in the face of the arbitrary reordering and partitioning
that <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code> and <code class="highlight"><span class="n">GENERALIZED_SUM</span></code> allow. Consider:</p>
<pre class="highlight"><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">></span> <span class="n">i</span><span class="p">{</span><span class="n">INT_MAX</span><span class="p">,</span> <span class="n">INT_MAX</span><span class="p">,</span> <span class="n">INT_MAX</span><span class="p">,</span> <span class="n">INT_MAX</span><span class="p">};</span>
<span class="n">big_int</span> <span class="n">bi</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">d</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">big_int</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

<span class="c1">// Possible result</span>
<span class="c1">// GSUM == GENERALIZED_SUM, GNSUM == GENERALIZED_NONCOMMUTATIVE_SUM</span>
<span class="c1">//</span>
<span class="c1">//   bi = GSUM(operator+, big_int(0), d[0], d[1], d[2], d[3]);</span>
<span class="c1">//      = operator+(GNSUM(operator+, d[0], big_int(0))</span>
<span class="c1">//                , GNSUM(operator+, d[1], d[2], d[3]));</span>
<span class="c1">//      = operator+(</span>
<span class="c1">//          operator+(</span>
<span class="c1">//            GNSUM(operator+, d[0]), GNSUM(operator+, big_int(0))</span>
<span class="c1">//          )</span>
<span class="c1">//        , operator+(</span>
<span class="c1">//            GNSUM(operator+, d[1], d[2]), GNSUM(operator+, d[3])</span>
<span class="c1">//          )</span>
<span class="c1">//        );</span>
<span class="c1">//      = operator+(</span>
<span class="c1">//          operator+(d[0], big_int(0))</span>
<span class="c1">//        , operator+(</span>
<span class="c1">//            operator+(GNSUM(operator+, d[1]), GNSUM(operator+, d[2])), d[3]</span>
<span class="c1">//          )</span>
<span class="c1">//        );</span>
<span class="c1">//      = operator+(</span>
<span class="c1">//          operator+(d[0], big_int(0))</span>
<span class="c1">//        , operator+(operator+(d[1], d[2]), d[3])</span>
<span class="c1">//        );</span>
<span class="c1">//      = ((d[0] + big_int(0)) + ((d[1] + d[2]) + d[3]));</span>
<span class="c1">//      = ((d[0] + big_int(0)) + ((int{INT_MAX} + int{INT_MAX}) + d[3]));</span>
<span class="c1">//      = ((d[0] + big_int(0)) + (int{-2} + int{INT_MAX}));</span>
<span class="c1">//      = ((int{INT_MAX} + big_int(0)) + int{INT_MAX - 2});</span>
<span class="c1">//      = (big_int(INT_MAX) + int{INT_MAX - 2});</span>
<span class="c1">//      = big_int(INT_MAX + INT_MAX - 2);</span>
<span class="c1">//</span>
<span class="c1">//   bi = 2 * INT_MAX - 2; // Instead of 4*INT_MAX</span>
</pre>
   <p>The above is just one possible result that <code class="highlight"><span class="n">reduce</span></code> could produce in such an
example. Note that in addition to performing some of the calculations with <code class="highlight"><span class="kt">int</span></code> as the intermediate type, <code class="highlight"><span class="n">reduce</span></code> also called <code class="highlight"><span class="n">binary_op</span></code> with the
initial value type as the <strong>second</strong> argument and the element from the sequence
(whose type is the <code class="highlight"><span class="n">InputIterators</span></code>'s value type) as the <strong>first</strong> argument.
The ordered algorithms always pass intermediate objects as the first argmuent
to the binary operator.</p>
   <p>It seems sensible that we should use the same rules I suggested for the ordered
algorithms (<a href="p0571r1.html#intermediate_policy">§3.4 Intermediate Type Policy for &lt;numeric> Algorithms</a>). This led me to the following
revised definitions for <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code> and <code class="highlight"><span class="n">GENERALIZED_SUM</span></code>:</p>
   <blockquote>
     1 Define <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">IntermediateType</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span><span class="p">)</span></code> as follows, where <code class="highlight"><span class="n">IntermediateType</span></code> is a type, <code class="highlight"><span class="n">op</span></code> is a binary function object (20.14 [<strong>function.object</strong>]), and <code class="highlight"><span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span></code> are expressions: 
    <ul>
     <li data-md="">
      <p>(1.1) <code class="highlight"><span class="n">a1</span></code> when <code class="highlight"><span class="n">N</span></code> is <code class="highlight"><span class="mi">1</span></code>, otherwise</p>
     <li data-md="">
      <p>(1.2) <code class="highlight"><span class="n">IntermediateType</span><span class="p">(</span><span class="n">op</span><span class="p">(</span><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aK</span><span class="p">),</span> <span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">aM</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span><span class="p">)))</span></code> for any <code class="highlight"><span class="n">K</span></code> where <code class="highlight"><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">K</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">M</span> ≤ <span class="n">N</span></code>.</p>
    </ul>
    <p>� <code class="highlight"><span class="n">IntermediateType</span></code> shall be constructible from the result of the expression <code class="highlight"><span class="n">op</span><span class="p">(</span><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aK</span><span class="p">),</span> <span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">aM</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span><span class="p">))</span></code>.</p>
    <p>2 Define <code class="highlight"><span class="n">GENERALIZED_SUM</span><span class="p">(</span><span class="n">IntermediateType</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span><span class="p">)</span></code> as <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">IntermediateType</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">bN</span><span class="p">)</span></code> where <code class="highlight"><span class="n">b1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">bN</span></code> may be any permutation of <code class="highlight"><span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span></code>.</p>
   </blockquote>
   <p>Note that the <code class="highlight"><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span></code> case intentionally does not convert to <code class="highlight"><span class="n">IntermediateType</span></code>,</p>
   <h3 class="heading settled" data-level="3.4" id="intermediate_policy"><span class="secno">3.4. </span><span class="content">Intermediate Type Policy for <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> Algorithms</span><a class="self-link" href="p0571r1.html#intermediate_policy"></a></h3>
   <p>In summary:</p>
   <blockquote>The intermediate type is the initial value type if there is an
initial value, and the value type of the <code class="highlight"><span class="n">InputIterator</span></code> otherwise.</blockquote>
   <h2 class="heading settled" data-level="4" id="type_reqs"><span class="secno">4. </span><span class="content">Type Requirements</span><a class="self-link" href="p0571r1.html#type_reqs"></a></h2>
   <p>Now that we have defined a clear policy for what the intermediate type should
be for each <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> algorithm
(<a href="p0571r1.html#intermediate_policy">§3.4 Intermediate Type Policy for &lt;numeric> Algorithms</a>), we can describe their requirements:</p>
   <ul>
    <li data-md="">
     <p>Operators shall neither modify elements nor invalidate iterators or subranges in the iterator ranges specified by their parameters.</p>
    <li data-md="">
     <p>The intermediate type shall be CopyConstructible (in-order-accumulator algorithms that take an initial value), constructible from <code class="highlight"><span class="o">*</span><span class="n">first</span></code> (in-order-accumulator algorithms that do not take an initial value), or constructible from <code class="highlight"><span class="n">op</span><span class="p">(</span><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aK</span><span class="p">),</span> <span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">aM</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span><span class="p">))</span></code> (<code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code> and <code class="highlight"><span class="n">GENERALIZED_SUM</span></code> algorithms). This requirement comes from the initialization of the accumulator object (in-order accumulator algorithms) or from the conversion to <code class="highlight"><span class="n">IntermediateType</span></code> (<code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code> and <code class="highlight"><span class="n">GENERALIZED_SUM</span></code> algorithms).</p>
    <li data-md="">
     <p>The right hand side of the update expression must be convertible to the intermediate type (all in-order-accumulator algorithms). This requirement comes from the update expression (the right hand side of <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">binary_op</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span></code>).</p>
    <li data-md="">
     <p>The intermediate type must be CopyAssignable (all in-order-accumulator algorithms except adjacent_difference) or MoveAssignable (adjacent_difference). This requirement comes from the update expression (the assignment in <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">binary_op</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span></code>).</p>
    <li data-md="">
     <p>The intermediate type shall be writable to the result output iterator (for algorithms which take an output range). This requirement comes from the write to the output iterator that is performed each iteration in these algorithms.</p>
   </ul>
   <p>For the function objects, we’ve already specified the requirements for what the return type of the invocations of <code class="highlight"><span class="n">binary_op</span></code> should be. We just need to require that:</p>
   <ul>
    <li data-md="">
     <p><code class="highlight"><span class="n">binary_op</span></code>, <code class="highlight"><span class="n">binary_op1</span></code>, <code class="highlight"><span class="n">binary_op2</span></code> and <code class="highlight"><span class="n">unary_op</span></code> are function objects.</p>
    <li data-md="">
     <p><code class="highlight"><span class="n">binary_op</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span></code> (all in-order-accumulator algorithms), <code class="highlight"><span class="n">acc</span> <span class="o">+</span> <span class="o">*</span><span class="n">i</span></code> (<code class="highlight"><span class="n">accumulate</span></code>, <code class="highlight"><span class="n">inner_product</span></code> and <code class="highlight"><span class="n">partial_sum</span></code>), <code class="highlight"><span class="n">acc</span> <span class="o">-</span> <span class="o">*</span><span class="n">i</span></code> (<code class="highlight"><span class="n">adjacent_difference</span></code>), <code class="highlight"><span class="n">binary_op1</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="n">binary_op2</span><span class="p">(</span><span class="o">*</span><span class="n">i1</span><span class="p">,</span> <span class="o">*</span><span class="n">i2</span><span class="p">))</span></code> (<code class="highlight"><span class="n">inner_product</span></code>) and <code class="highlight"><span class="n">acc</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">i1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">i2</span><span class="p">)</span></code> are required.</p>
    <li data-md="">
     <p>The function object requirements from the new algorithms are in <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code> and <code class="highlight"><span class="n">GENERALIZED_SUM</span></code>:</p>
     <ul>
      <li data-md="">
       <p>If <code class="highlight"><span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span></code> are of the same type (e.g. the homogeneous elements of an iterator range), then <code class="highlight"><span class="n">op</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span></code> is the only signature required by <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code> and <code class="highlight"><span class="n">GENERALIZED_SUM</span></code>. This covers the new algorithms which do not take an initial value type.</p>
      <li data-md="">
       <p>If <code class="highlight"><span class="n">a1</span></code> is of one type and <code class="highlight"><span class="n">a2</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span></code> are of the same type (e.g. an initial value <code class="highlight"><span class="n">a1</span></code> and the homogeneous elements of an iterator range <code class="highlight"><span class="n">a2</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span></code>), then <code class="highlight"><span class="n">op</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span></code>, <code class="highlight"><span class="n">op</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span></code>, <code class="highlight"><span class="n">op</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span></code> and <code class="highlight"><span class="n">op</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span></code> are required by <code class="highlight"><span class="n">GENERALIZED_SUM</span></code> and <code class="highlight"><span class="n">op</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span></code>, <code class="highlight"><span class="n">op</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span></code> and <code class="highlight"><span class="n">op</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span></code> are required for <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span></code>. This covers the new algorithms which do take an initial value type.</p>
     </ul>
   </ul>
   <p>While the new algorithms introduced by the Parallelism TS do have the necessary
requirements forbidding modification of iterator ranges, the ranges used are 
not fully closed like the rest of the <code class="highlight"><span class="o">&lt;</span><span class="n">numeric</span><span class="o">></span></code> algorithms.</p>
   <p>There is one additional outlier case. <code class="highlight"><span class="n">reduce</span></code> has a signature which only takes
two <code class="highlight"><span class="n">InputIterator</span></code>'s and is defined as equivalent to <code class="highlight"><span class="k">return</span> <span class="nf">reduce</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="k">typename</span> <span class="n">iterator_traits</span><span class="o">&lt;</span><span class="n">InputIterator</span><span class="o">>::</span><span class="n">value_type</span><span class="p">{});</span></code>. This requires
that <code class="highlight"><span class="n">InputIterator</span></code>'s value type be DefaultConstructible. <code class="highlight"><span class="n">accumulate</span></code> does
not have such a signature (by design, I believe). Ideally, I’d like to remove
this signature, but I think it is too late to do so. I’d like to add the
missing requirement, at least.</p>
   <h2 class="heading settled" data-level="5" id="proposed_changes"><span class="secno">5. </span><span class="content">Proposed Changes</span><a class="self-link" href="p0571r1.html#proposed_changes"></a></h2>
   <p>The proposed changes are relative to <a data-link-type="biblio" href="p0571r1.html#biblio-n4604">[N4604]</a>, the Committee Draft for C++17.
The � character is used to denote a placeholder section number which the editor
shall choose.</p>
   <p>Apply the following changes to 26.2 [<strong>numerics.defns</strong>]:</p>
   <blockquote>
     <strong>26.2 Definitions</strong> [<strong>numerics.defns</strong>] 
    <p>
     1 Define <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><ins><span class="n">IntermediateType</span><span class="p">,</span> </ins><span class="n">op</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span><span class="p">)</span></code> as follows
     <ins>, where <code class="highlight"><span class="n">IntermediateType</span></code> is a type, <code class="highlight"><span class="n">op</span></code> is a binary function object (20.14 [<strong>function.object</strong>]), and <code class="highlight"><span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span></code> are expressions</ins>
     :
    </p>
    <ul>
     <li data-md="">
      <p>(1.1) <code class="highlight"><span class="n">a1</span></code> when <code class="highlight"><span class="n">N</span></code> is <code class="highlight"><span class="mi">1</span></code>, otherwise</p>
     <li data-md="">
      <p>(1.2) <code class="highlight"><ins><span class="n">IntermediateType</span><span class="p">(</span></ins><span class="n">op</span><span class="p">(</span><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aK</span><span class="p">),</span> <span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">aM</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span><span class="p">))</span><ins><span class="p">)</span></ins></code> for any <code class="highlight"><span class="n">K</span></code> where <code class="highlight"><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">K</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">M</span> ≤ <span class="n">N</span></code>.</p>
    </ul>
    <ins>� <code class="highlight"><span class="n">IntermediateType</span></code> shall be constructible from the result of the expression <code class="highlight"><span class="n">op</span><span class="p">(</span><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aK</span><span class="p">),</span> <span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">aM</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span><span class="p">))</span></code>.</ins>
    <p>2 Define <code class="highlight"><span class="n">GENERALIZED_SUM</span><span class="p">(</span><ins><span class="n">IntermediateType</span><span class="p">,</span> </ins><span class="n">op</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span><span class="p">)</span></code> as <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><ins><span class="n">IntermediateType</span><span class="p">,</span> </ins><span class="n">op</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">bN</span><span class="p">)</span></code> where <code class="highlight"><span class="n">b1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">bN</span></code> may be any permutation of <code class="highlight"><span class="n">a1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">aN</span></code>.</p>
   </blockquote>
   <p>Apply the following changes to 26.8 [<strong>numeric.ops</strong>] starting at 28.8.2 [<strong>accumulate</strong>]:</p>
   <blockquote>
     <strong>26.8.2 Accumulate</strong> [<strong>accumulate</strong>] 
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="o">></span>
  <span class="n">T</span> <span class="n">accumulate</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
               <span class="n">T</span> <span class="n">init</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="o">></span>
  <span class="n">T</span> <span class="n">accumulate</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
               <span class="n">T</span> <span class="n">init</span><span class="p">,</span>
               <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">);</span>
</pre>
    <p>
     1 <em>Effects:</em> Computes its result by initializing the accumulator <code class="highlight"><span class="n">acc</span></code> 
     <ins>, whose type is <code class="highlight"><span class="n">T</span></code>,</ins>
      with the initial value <code class="highlight"><span class="n">init</span></code> and then modifies it with <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="o">+</span> <span class="o">*</span><span class="n">i</span></code> or <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">binary_op</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span></code> for every iterator <code class="highlight"><span class="n">i</span></code> in the range <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span></code> in order.
    </p>
    <p>
     2 <em>Requires:</em> <code class="highlight"><span class="n">T</span></code> shall meet the requirements of <code class="highlight"><span class="n">CopyConstructible</span></code> (Table 22) and <code class="highlight"><span class="n">CopyAssignable</span></code> (Table 24) types.
     <ins> The result of the expression <code class="highlight"><span class="n">acc</span> <span class="o">+</span> <span class="o">*</span><span class="n">i</span></code> or <code class="highlight"><span class="n">binary_op</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span></code> shall be implicitly convertible to <code class="highlight"><span class="n">T</span></code>.</ins>
      In the range <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">]</span></code>, <code class="highlight"><span class="n">binary_op</span></code> shall neither modify elements nor invalidate iterators or subranges.
    </p>
    <p><strong>26.8.3 Reduce</strong> [<strong>reduce</strong>]</p>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="o">></span>
  <span class="k">typename</span> <span class="n">iterator_traits</span><span class="o">&lt;</span><span class="n">InputIterator</span><span class="o">>::</span><span class="n">value_type</span>
    <span class="n">reduce</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">);</span>
</pre>
    <p>1 <em>Effects:</em> Equivalent to: <code class="highlight"><span class="k">return</span> <span class="nf">reduce</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="k">typename</span> <span class="n">iterator_traits</span><span class="o">&lt;</span><span class="n">InputIterator</span><span class="o">>::</span><span class="n">value_type</span><span class="p">{});</span></code></p>
    <ins>� <em>Requires:</em> <code class="highlight"><span class="n">InputIterator</span></code>'s value type shall satisfy the requirements of <code class="highlight"><span class="n">DefaultConstructible</span></code> (Table 20).</ins>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="o">></span>
  <span class="n">T</span> <span class="n">reduce</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
           <span class="n">T</span> <span class="n">init</span><span class="p">);</span>
</pre>
    <p>2 <em>Effects:</em> Equivalent to: <code class="highlight"><span class="k">return</span> <span class="nf">reduce</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">plus</span><span class="o">&lt;></span><span class="p">());</span></code></p>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="o">></span>
  <span class="n">T</span> <span class="n">reduce</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
           <span class="n">T</span> <span class="n">init</span><span class="p">,</span>
           <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">);</span>
</pre>
    <p>3 <em>Returns:</em> <code class="highlight"><span class="n">GENERALIZED_SUM</span><span class="p">(</span><ins><span class="n">T</span><span class="p">,</span> </ins><span class="n">binary_op</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="p">...)</span></code> for every <code class="highlight"><span class="n">i</span></code> in <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span></code>.</p>
    <p>4 <em>Requires:</em> <code class="highlight"><span class="n">binary_op</span></code> shall neither invalidate iterators or subranges, nor modify elements in the range <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><del><span class="p">)</span></del><ins><span class="p">]</span></ins></code>.</p>
    <p>5 <em>Complexity:</em> <code class="highlight"><span class="n">O</span><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span></code> applications of <code class="highlight"><span class="n">binary_op</span></code>.</p>
    <p>6 <em>Notes:</em> The difference between <code class="highlight"><span class="n">reduce</span></code> and <code class="highlight"><span class="n">accumulate</span></code> is that <code class="highlight"><span class="n">reduce</span></code> applies <code class="highlight"><span class="n">binary_op</span></code> in an unspecified order, which yields a non-deterministic result for non-associative or non-commutative <code class="highlight"><span class="n">binary_op</span></code> such as floating-point addition.</p>
    <p><strong>26.8.4 Transform reduce</strong> [<strong>transform.reduce</strong>]</p>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">UnaryOperation</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="o">></span>
  <span class="n">T</span> <span class="n">transform_reduce</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                     <span class="n">UnaryOperation</span> <span class="n">unary_op</span><span class="p">,</span>
                     <span class="n">T</span> <span class="n">init</span><span class="p">,</span>
                     <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">);</span>
</pre>
    <p>1 <em>Returns:</em> <code class="highlight"><span class="n">GENERALIZED_SUM</span><span class="p">(</span><ins><span class="n">T</span><span class="p">,</span> </ins><span class="n">binary_op</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">unary_op</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">),</span> <span class="p">...)</span></code> for every <code class="highlight"><span class="n">i</span></code> in <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span></code>.</p>
    <p>2 <em>Requires:</em> Neither <code class="highlight"><span class="n">unary_op</span></code> nor <code class="highlight"><span class="n">binary_op</span></code> shall invalidate subranges, or modify elements in the range <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><del><span class="p">)</span></del><ins><span class="p">]</span></ins></code>.</p>
    <p>3 <em>Complexity:</em> <code class="highlight"><span class="n">O</span><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span></code> applications each of <code class="highlight"><span class="n">unary_op</span></code> and <code class="highlight"><span class="n">binary_op</span></code>.</p>
    <p>4 <em>Notes:</em> <code class="highlight"><span class="n">transform_reduce</span></code> does not apply <code class="highlight"><span class="n">unary_op</span></code> to <code class="highlight"><span class="n">init</span></code>.</p>
    <p><strong>26.8.5 Inner product</strong> [<strong>inner.product</strong>]</p>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator1</span><span class="p">,</span> <span class="k">class</span> <span class="nc">InputIterator2</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="o">></span>
  <span class="n">T</span> <span class="n">inner_product</span><span class="p">(</span><span class="n">InputIterator1</span> <span class="n">first1</span><span class="p">,</span> <span class="n">InputIterator1</span> <span class="n">last1</span><span class="p">,</span>
                  <span class="n">InputIterator2</span> <span class="n">first2</span><span class="p">,</span>
                  <span class="n">T</span> <span class="n">init</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator1</span><span class="p">,</span> <span class="k">class</span> <span class="nc">InputIterator2</span><span class="p">,</span> <span class="k">class</span> <span class="nc">T</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation1</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation2</span><span class="o">></span>
  <span class="n">T</span> <span class="n">inner_product</span><span class="p">(</span><span class="n">InputIterator1</span> <span class="n">first1</span><span class="p">,</span> <span class="n">InputIterator1</span> <span class="n">last1</span><span class="p">,</span>
                  <span class="n">InputIterator2</span> <span class="n">first2</span><span class="p">,</span>
                  <span class="n">T</span> <span class="n">init</span><span class="p">,</span>
                  <span class="n">BinaryOperation1</span> <span class="n">binary_op1</span><span class="p">,</span>
                  <span class="n">BinaryOperation2</span> <span class="n">binary_op2</span><span class="p">);</span>
</pre>
    <p>
     1 <em>Effects:</em> Computes its result by initializing the accumulator <code class="highlight"><span class="n">acc</span></code> 
     <ins>, whose type is <code class="highlight"><span class="n">T</span></code>,</ins>
      with the initial value <code class="highlight"><span class="n">init</span></code> and then modifying it with <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">i1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">i2</span><span class="p">)</span></code> or <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">binary_op1</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="n">binary_op2</span><span class="p">(</span><span class="o">*</span><span class="n">i1</span><span class="p">,</span> <span class="o">*</span><span class="n">i2</span><span class="p">))</span></code> for every iterator <code class="highlight"><span class="n">i1</span></code> in the range <code class="highlight"><span class="p">[</span><span class="n">first1</span><span class="p">,</span> <span class="n">last1</span><span class="p">)</span></code> and iterator <code class="highlight"><span class="n">i2</span></code> in the range <code class="highlight"><span class="p">[</span><span class="n">first2</span><span class="p">,</span> <span class="n">first2</span> <span class="o">+</span> <span class="p">(</span><span class="n">last1</span> <span class="o">-</span> <span class="n">first1</span><span class="p">))</span></code> in order.
    </p>
    <p>
     2 <em>Requires:</em> <code class="highlight"><span class="n">T</span></code> shall meet the requirements of <code class="highlight"><span class="n">CopyConstructible</span></code> (Table 22) and <code class="highlight"><span class="n">CopyAssignable</span></code> (Table 24) types. 
     <ins>The result of the expression <code class="highlight"><span class="n">acc</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">i1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">i2</span><span class="p">)</span></code> or <code class="highlight"><span class="n">binary_op1</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="n">binary_op2</span><span class="p">(</span><span class="o">*</span><span class="n">i1</span><span class="p">,</span> <span class="o">*</span><span class="n">i2</span><span class="p">))</span></code> shall be implicitly convertible to <code class="highlight"><span class="n">T</span></code>.</ins>
      In the ranges <code class="highlight"><span class="p">[</span><span class="n">first1</span><span class="p">,</span> <span class="n">last1</span><span class="p">]</span></code> and <code class="highlight"><span class="p">[</span><span class="n">first2</span><span class="p">,</span> <span class="n">first2</span> <span class="o">+</span> <span class="p">(</span><span class="n">last1</span> <span class="o">-</span> <span class="n">first1</span><span class="p">)]</span></code> <code class="highlight"><span class="n">binary_op1</span></code> and <code class="highlight"><span class="n">binary_op2</span></code> shall neither modify elements nor invalidate iterators or subranges.
    </p>
    <p><strong>26.8.6 Partial sum</strong> [<strong>partial.sum</strong>]</p>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">partial_sum</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                             <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">partial_sum</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                             <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">,</span>
                             <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">);</span>
</pre>
    <p>1 <em>Effects:</em> For a non-empty range, the function creates an accumulator <code class="highlight"><span class="n">acc</span></code> whose type is <code class="highlight"><span class="n">InputIterator</span></code>'s value type, initializes it with <code class="highlight"><span class="o">*</span><span class="n">first</span></code>, and assigns the result to <code class="highlight"><span class="o">*</span><span class="n">result</span></code>. For every iterator <code class="highlight"><span class="n">i</span></code> in <code class="highlight"><span class="p">[</span><span class="n">first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span></code> in order, <code class="highlight"><span class="n">acc</span></code> is then modified by <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span> <span class="o">+</span> <span class="o">*</span><span class="n">i</span></code> or <code class="highlight"><span class="n">acc</span> <span class="o">=</span> <span class="n">binary_op</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span></code> and the result is assigned to <code class="highlight"><span class="o">*</span><span class="p">(</span><span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">first</span><span class="p">))</span></code>.</p>
    <p>2 <em>Returns:</em> <code class="highlight"><span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span></code>.</p>
    <p>3 <em>Complexity:</em> Exactly <code class="highlight"><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span></code> applications of the binary operation.</p>
    <p>
     4 <em>Requires:</em> <code class="highlight"><span class="n">InputIterator</span></code>'s value type shall be 
     <ins><code class="highlight"><span class="n">CopyAssignable</span></code> (Table 24) and</ins>
      constructible from the type of <code class="highlight"><span class="o">*</span><span class="n">first</span></code>. The result of the expression <code class="highlight"><span class="n">acc</span> <span class="o">+</span> <span class="o">*</span><span class="n">i</span></code> or <code class="highlight"><span class="n">binary_op</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span></code> shall be implicitly convertible to <code class="highlight"><span class="n">InputIterator</span></code>'s value type. <code class="highlight"><span class="n">acc</span></code> shall be writable (24.2.1) to the <code class="highlight"><span class="n">result</span></code> output iterator. In the ranges <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">]</span></code> and <code class="highlight"><span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)]</span></code> <code class="highlight"><span class="n">binary_op</span></code> shall neither modify elements nor invalidate iterators or subranges.
    </p>
    <p>5 <em>Remarks:</em> <code class="highlight"><span class="n">result</span></code> may be equal to <code class="highlight"><span class="n">first</span></code>.</p>
    <p><strong>26.8.7 Exclusive scan</strong> [<strong>exclusive.scan</strong>]</p>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">exclusive_scan</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                                <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">,</span>
                                <span class="n">T</span> <span class="n">init</span><span class="p">);</span>
</pre>
    <p>1 <em>Effects:</em> Equivalent to: <code class="highlight"><span class="k">return</span> <span class="nf">exclusive_scan</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">plus</span><span class="o">&lt;></span><span class="p">());</span></code></p>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">exclusive_scan</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                                <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">,</span>
                                <span class="n">T</span> <span class="n">init</span><span class="p">,</span>
                                <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">);</span>
</pre>
    <p>2 <em>Effects:</em> Assigns through each iterator <code class="highlight"><span class="n">i</span></code> in <code class="highlight"><span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">))</span></code> the value of <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><ins><span class="n">T</span><span class="p">,</span> </ins><span class="n">binary_op</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="o">*</span><span class="n">j</span><span class="p">,</span> <span class="p">...)</span></code> for every <code class="highlight"><span class="n">j</span></code> in <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">first</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">result</span><span class="p">))</span></code>.</p>
    <p>3 <em>Returns:</em> The end of the resulting range beginning at <code class="highlight"><span class="n">result</span></code>.</p>
    <p>
     4 <em>Requires:</em> 
     <ins><code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">binary_op</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">unary_op</span><span class="p">(</span><span class="o">*</span><span class="n">j</span><span class="p">),</span> <span class="p">...)</span></code> shall be writable (24.2.1) to the <code class="highlight"><span class="n">result</span></code> output iterator.</ins>
      <code class="highlight"><span class="n">binary_op</span></code> shall neither invalidate iterators or subranges, nor modify elements in the ranges <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><del><span class="p">)</span></del><ins><span class="p">]</span></ins></code> or <code class="highlight"><span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span><del><span class="p">)</span></del><ins><span class="p">]</span></ins></code>.
    </p>
    <p>5 <em>Complexity:</em> <code class="highlight"><span class="n">O</span><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span></code> applications of <code class="highlight"><span class="n">binary_op</span></code>.</p>
    <p>6 <em>Notes:</em> The difference between <code class="highlight"><span class="n">exclusive_scan</span></code> and <code class="highlight"><span class="n">inclusive_scan</span></code> is that <code class="highlight"><span class="n">exclusive_scan</span></code> excludes the ith input element from the ith sum. If <code class="highlight"><span class="n">binary_op</span></code> is not mathematically associative, the behavior of <code class="highlight"><span class="n">exclusive_scan</span></code> may be non-deterministic.</p>
    <p>7 <em>Remarks:</em> <code class="highlight"><span class="n">result</span></code> may be equal to <code class="highlight"><span class="n">first</span></code>.</p>
    <p><strong>26.8.8 Inclusive scan</strong> [<strong>inclusive.scan</strong>]</p>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">inclusive_scan</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                                <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">);</span>
</pre>
    <p>1 <em>Effects:</em> Equivalent to: <code class="highlight"><span class="k">return</span> <span class="nf">inclusive_scan</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">plus</span><span class="o">&lt;></span><span class="p">());</span></code></p>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">inclusive_scan</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                                <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">,</span>
                                <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">inclusive_scan</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                                <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">,</span>
                                <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">,</span>
                                <span class="n">T</span> <span class="n">init</span><span class="p">);</span>
</pre>
    <p>2 <em>Effects:</em> Assigns through each iterator <code class="highlight"><span class="n">i</span></code> in <code class="highlight"><span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">))</span></code> the value of</p>
    <ul>
     <li data-md="">
      <p>(2.1) <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><ins><span class="n">T</span><span class="p">,</span> </ins><span class="n">binary_op</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="o">*</span><span class="n">j</span><span class="p">,</span> <span class="p">...)</span></code> for every <code class="highlight"><span class="n">j</span></code> in <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">first</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">result</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span></code> if <code class="highlight"><span class="n">init</span></code> is provided, or</p>
     <li data-md="">
      <p>(2.2) <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><ins><span class="k">typename</span> <span class="n">iterator_traits</span><span class="o">&lt;</span><span class="n">InputIterator</span><span class="o">>::</span><span class="n">value_type</span><span class="p">,</span> </ins><span class="n">binary_op</span><span class="p">,</span> <span class="o">*</span><span class="n">j</span><span class="p">,</span> <span class="p">...)</span></code> for every <code class="highlight"><span class="n">j</span></code> in <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">first</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">result</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span></code> otherwise.</p>
    </ul>
    <p>3 <em>Returns:</em> The end of the resulting range beginning at <code class="highlight"><span class="n">result</span></code>.</p>
    <p>
     4 <em>Requires:</em> 
     <ins><code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">binary_op</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="o">*</span><span class="n">j</span><span class="p">,</span> <span class="p">...)</span></code> shall be writable (24.2.1) to the <code class="highlight"><span class="n">result</span></code> output iterator if <code class="highlight"><span class="n">init</span></code> is provided; otherwise <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="k">typename</span> <span class="n">iterator_traits</span><span class="o">&lt;</span><span class="n">InputIterator</span><span class="o">>::</span><span class="n">value_type</span><span class="p">,</span> <span class="n">binary_op</span><span class="p">,</span> <span class="o">*</span><span class="n">j</span><span class="p">,</span> <span class="p">...)</span></code> shall be writable to the <code class="highlight"><span class="n">result</span></code> output iterator.</ins>
      <code class="highlight"><span class="n">binary_op</span></code> shall not invalidate iterators or subranges, nor modify elements in the ranges <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><del><span class="p">)</span></del><ins><span class="p">]</span></ins></code> or <code class="highlight"><span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span><del><span class="p">)</span></del><ins><span class="p">]</span></ins></code>.
    </p>
    <p>5 <em>Complexity:</em> <code class="highlight"><span class="n">O</span><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span></code> applications of <code class="highlight"><span class="n">binary_op</span></code>.</p>
    <p>6 <em>Remarks:</em> <code class="highlight"><span class="n">result</span></code> may be equal to <code class="highlight"><span class="n">first</span></code>.</p>
    <p>7 <em>Notes:</em> The difference between <code class="highlight"><span class="n">exclusive_scan</span></code> and <code class="highlight"><span class="n">inclusive_scan</span></code> is that <code class="highlight"><span class="n">inclusive_scan</span></code> includes the ith input element in the ith sum. If <code class="highlight"><span class="n">binary_op</span></code> is not mathematically associative, the behavior of <code class="highlight"><span class="n">inclusive_scan</span></code> may be non-deterministic.</p>
    <p><strong>26.8.9 Transform exclusive scan</strong> [<strong>transform.exclusive.scan</strong>]</p>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">UnaryOperation</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">transform_exclusive_scan</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                                          <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">,</span>
                                          <span class="n">UnaryOperation</span> <span class="n">unary_op</span><span class="p">,</span>
                                          <span class="n">T</span> <span class="n">init</span><span class="p">,</span>
                                          <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">);</span>
</pre>
    <p>1 <em>Effects:</em> Assigns through each iterator <code class="highlight"><span class="n">i</span></code> in <code class="highlight"><span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">))</span></code> the value of <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><ins><span class="n">T</span><span class="p">,</span> </ins><span class="n">binary_op</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">unary_op</span><span class="p">(</span><span class="o">*</span><span class="n">j</span><span class="p">),</span> <span class="p">...)</span></code> for every <code class="highlight"><span class="n">j</span></code> in <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">first</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">result</span><span class="p">))</span></code>.</p>
    <p>2 <em>Returns:</em> The end of the resulting range beginning at <code class="highlight"><span class="n">result</span></code>.</p>
    <p>
     3 <em>Requires:</em> 
     <ins><code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">binary_op</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">unary_op</span><span class="p">(</span><span class="o">*</span><span class="n">j</span><span class="p">),</span> <span class="p">...)</span></code> shall be writable (24.2.1) to the <code class="highlight"><span class="n">result</span></code> output iterator.</ins>
      Neither <code class="highlight"><span class="n">unary_op</span></code> nor <code class="highlight"><span class="n">binary_op</span></code> shall invalidate iterators or subranges, or modify elements in the ranges <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><del><span class="p">)</span></del><ins><span class="p">]</span></ins></code> or <code class="highlight"><span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><del><span class="p">)</span></del><ins><span class="p">]</span></ins></code>.
    </p>
    <p>4 <em>Complexity:</em> <code class="highlight"><span class="n">O</span><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span></code> applications each of <code class="highlight"><span class="n">unary_op</span></code> and <code class="highlight"><span class="n">binary_op</span></code>.</p>
    <p>5 <em>Remarks:</em> <code class="highlight"><span class="n">result</span></code> may be equal to <code class="highlight"><span class="n">first</span></code>.</p>
    <p>6 <em>Notes:</em> The difference between <code class="highlight"><span class="n">transform_exclusive_scan</span></code> and <code class="highlight"><span class="n">transform_inclusive_scan</span></code> is that <code class="highlight"><span class="n">transform_exclusive_scan</span></code> excludes the ith input element from the ith sum. If <code class="highlight"><span class="n">binary_op</span></code> is not mathematically associative, the behavior of <code class="highlight"><span class="n">transform_exclusive_scan</span></code> may be non-deterministic. <code class="highlight"><span class="n">transform_exclusive_scan</span></code> does not apply <code class="highlight"><span class="n">unary_op</span></code> to <code class="highlight"><span class="n">init</span></code>.</p>
    <p><strong>26.8.10 Transform inclusive scan</strong> [<strong>transform.inclusive.scan</strong>]</p>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">UnaryOperation</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">transform_inclusive_scan</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                                          <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">,</span>
                                          <span class="n">UnaryOperation</span> <span class="n">unary_op</span><span class="p">,</span>
                                          <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">OutputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">UnaryOperation</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">T</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">transform_inclusive_scan</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                                          <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">,</span>
                                          <span class="n">UnaryOperation</span> <span class="n">unary_op</span><span class="p">,</span>
                                          <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">,</span>
                                          <span class="n">T</span> <span class="n">init</span><span class="p">);</span>
</pre>
    <p>1 <em>Effects:</em> Assigns through each iterator <code class="highlight"><span class="n">i</span></code> in <code class="highlight"><span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">))</span></code> the value of</p>
    <ul>
     <li data-md="">
      <p>(1.1) <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><ins><span class="n">T</span><span class="p">,</span> </ins><span class="n">binary_op</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">unary_op</span><span class="p">(</span><span class="o">*</span><span class="n">j</span><span class="p">),</span> <span class="p">...)</span></code> for every j in <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">first</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">result</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span></code> if <code class="highlight"><span class="n">init</span></code> is provided, or</p>
     <li data-md="">
      <p>(1.2) <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><ins><span class="k">typename</span> <span class="n">iterator_traits</span><span class="o">&lt;</span><span class="n">InputIterator</span><span class="o">>::</span><span class="n">value_type</span><span class="p">,</span> </ins><span class="n">binary_op</span><span class="p">,</span> <span class="n">unary_op</span><span class="p">(</span><span class="o">*</span><span class="n">j</span><span class="p">),</span> <span class="p">...)</span></code> for every <code class="highlight"><span class="n">j</span></code> in <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">first</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">result</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span></code> otherwise.</p>
    </ul>
    <p>2 <em>Returns:</em> The end of the resulting range beginning at <code class="highlight"><span class="n">result</span></code>.</p>
    <p>
     3 <em>Requires:</em> 
     <ins><code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">binary_op</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">unary_op</span><span class="p">(</span><span class="o">*</span><span class="n">j</span><span class="p">),</span> <span class="p">...)</span></code> shall be writable (24.2.1) to the <code class="highlight"><span class="n">result</span></code> output iterator if <code class="highlight"><span class="n">init</span></code> is provided; otherwise <code class="highlight"><span class="n">GENERALIZED_NONCOMMUTATIVE_SUM</span><span class="p">(</span><span class="k">typename</span> <span class="n">iterator_traits</span><span class="o">&lt;</span><span class="n">InputIterator</span><span class="o">>::</span><span class="n">value_type</span><span class="p">,</span> <span class="n">binary_op</span><span class="p">,</span> <span class="n">unary_op</span><span class="p">(</span><span class="o">*</span><span class="n">j</span><span class="p">),</span> <span class="p">...)</span></code> shall be writable to the <code class="highlight"><span class="n">result</span></code> output iterator.</ins>
      Neither <code class="highlight"><span class="n">unary_op</span></code> nor <code class="highlight"><span class="n">binary_op</span></code> shall invalidate iterators or subranges, or modify elements in the ranges <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><del><span class="p">)</span></del><ins><span class="p">]</span></ins></code> or <code class="highlight"><span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span><del><span class="p">)</span></del><ins><span class="p">]</span></ins></code>.
    </p>
    <p>4 <em>Complexity:</em> <code class="highlight"><span class="n">O</span><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span></code> applications each of <code class="highlight"><span class="n">unary_op</span></code> and <code class="highlight"><span class="n">binary_op</span></code>.</p>
    <p>5 <em>Remarks:</em> <code class="highlight"><span class="n">result</span></code> may be equal to <code class="highlight"><span class="n">first</span></code>.</p>
    <p>6 <em>Notes:</em> The difference between <code class="highlight"><span class="n">transform_exclusive_scan</span></code> and <code class="highlight"><span class="n">transform_inclusive_scan</span></code> is that <code class="highlight"><span class="n">transform_inclusive_scan</span></code> includes the ith input element in the ith sum. If <code class="highlight"><span class="n">binary_op</span></code> is not mathematically associative, the behavior of <code class="highlight"><span class="n">transform_inclusive_scan</span></code> may be non-deterministic. <code class="highlight"><span class="n">transform_inclusive_scan</span></code> does not apply <code class="highlight"><span class="n">unary_op</span></code> to <code class="highlight"><span class="n">init</span></code>.</p>
    <p><strong>26.8.11 Adjacent difference</strong> [<strong>adjacent.difference</strong>]</p>
<pre class="highlight"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span>
             <span class="k">class</span> <span class="nc">OutputIterator</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">adjacent_difference</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                                     <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">InputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">OutputIterator</span><span class="p">,</span>
          <span class="k">class</span> <span class="nc">BinaryOperation</span><span class="o">></span>
  <span class="n">OutputIterator</span> <span class="n">adjacent_difference</span><span class="p">(</span><span class="n">InputIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIterator</span> <span class="n">last</span><span class="p">,</span>
                                     <span class="n">OutputIterator</span> <span class="n">result</span><span class="p">,</span>
                                     <span class="n">BinaryOperation</span> <span class="n">binary_op</span><span class="p">);</span>
</pre>
    <p>1 <em>Effects:</em> For a non-empty range, the function creates an accumulator <code class="highlight"><span class="n">acc</span></code> whose type is <code class="highlight"><span class="n">InputIterator</span></code>'s value type, initializes it with <code class="highlight"><span class="o">*</span><span class="n">first</span></code>, and assigns the result to <code class="highlight"><span class="o">*</span><span class="n">result</span></code>. For every iterator <code class="highlight"><span class="n">i</span></code> in <code class="highlight"><span class="p">[</span><span class="n">first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span></code> in order, creates an object <code class="highlight"><span class="n">val</span></code> whose type is <code class="highlight"><span class="n">InputIterator</span></code>'s value type, initializes it with <code class="highlight"><span class="o">*</span><span class="n">i</span></code>, computes <code class="highlight"><span class="n">val</span> <span class="o">-</span> <span class="n">acc</span></code> or <code class="highlight"><span class="n">binary_op</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span></code>, assigns the result to <code class="highlight"><span class="o">*</span><span class="p">(</span><span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">first</span><span class="p">))</span></code>, and move assigns from <code class="highlight"><span class="n">val</span></code> to <code class="highlight"><span class="n">acc</span></code>.</p>
    <p>2 <em>Requires:</em> <code class="highlight"><span class="n">InputIterator</span></code>'s value type shall be <code class="highlight"><span class="n">MoveAssignable</span></code> (Table 23) and shall be constructible from the type of <code class="highlight"><span class="o">*</span><span class="n">first</span></code>. <code class="highlight"><span class="n">acc</span></code> shall be writable (24.2.1) to the <code class="highlight"><span class="n">result</span></code> output iterator. The result of the expression <code class="highlight"><span class="n">val</span> <span class="o">-</span> <span class="n">acc</span></code> or <code class="highlight"><span class="n">binary_op</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span></code> shall be writable to the <code class="highlight"><span class="n">result</span></code> output iterator. In the ranges <code class="highlight"><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">]</span></code> and <code class="highlight"><span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)]</span></code>, <code class="highlight"><span class="n">binary_op</span></code> shall neither modify elements nor invalidate iterators or subranges.</p>
    <p>3 <em>Remarks:</em> <code class="highlight"><span class="n">result</span></code> may be equal to <code class="highlight"><span class="n">first</span></code>.</p>
    <p>4 <em>Returns:</em> <code class="highlight"><span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span></code>.</p>
    <p>5 <em>Complexity:</em> Exactly <code class="highlight"><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span></code> applications of the binary operation.</p>
   </blockquote>
  </main>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="p0571r1.html#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="p0571r1.html#informative"></a></h3>
  <dl>
   <dt id="biblio-n4604">[N4604]
   <dd>Richard Smith. <a href="https://wg21.link/n4604">C++17 CD Ballot Document</a>. 12 July 2016. URL: <a href="https://wg21.link/n4604">https://wg21.link/n4604</a>
   <dt id="biblio-p0452r0">[P0452r0]
   <dd>Bryce Adelstein Lelbach. <a href="https://wg21.link/p0452r0">Binary transform_reduce(): The Missing Overload</a>. 14 October 2016. URL: <a href="https://wg21.link/p0452r0">https://wg21.link/p0452r0</a>
  </dl>